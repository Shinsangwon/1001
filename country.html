<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>세계 나라 퀴즈 게임</title>
  <style>
    body {
      font-family: "Comic Sans MS", sans-serif;
      text-align: center;
      background-color: #fef6fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 480px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      color: #ff6f91;
    }
    button {
      margin: 8px;
      padding: 12px 18px;
      border: none;
      border-radius: 12px;
      background-color: #ffb347;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #ff944d;
    }
    .flag {
      width: 160px;
      margin: 15px auto;
      display: block;
      border: 2px solid #ddd;
      border-radius: 10px;
    }
    .choice-btn {
      display:block;
      margin:8px auto;
      padding:12px;
      border-radius:10px;
      border:none;
      width:90%;
      max-width:300px;
      background:#fff;
      cursor:pointer;
    }
    .choice-img {
      width: 180px;
      height: auto;
      display: block;
      margin: 10px auto;
      border: 3px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
    }
    #feedbackMsg {
      font-size: 18px;
      margin: 15px 0;
    }
    #feedbackFlag {
      margin-top: 10px;
      width: 200px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      border: 3px solid #ddd;
      border-radius: 10px;
    }
    .back-btn {
      margin-top: 20px;
      background-color: #87ceeb;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 초기 화면 -->
    <div id="start">
      <h1>🌍 세계 나라 퀴즈 게임1.0</h1>
      <p>플레이어를 선택하세요</p>
      <div id="players"></div>
      <input type="text" id="newPlayer" placeholder="새 참가자 입력">
      <button onclick="addPlayer()">추가</button>
      <h3>게임을 선택하세요</h3>
      <p>📢 각 게임은 10문제가 출제됩니다.</p>
      <button onclick="startGame(1)">1. 나라이름 → 수도 맞추기</button>
      <button onclick="startGame(2)">2. 국기 → 나라이름 맞추기</button>
      <button onclick="startGame(3)">3. 나라이름 → 국기 맞추기</button>
    </div>

    <!-- 게임 화면 -->
    <div id="game" style="display:none;">
      <h2 id="progress"></h2>
      <h2 id="question"></h2>
      <img id="flag" class="flag" style="display:none;">
      <div id="choices"></div>
      <div class="back-btn">
        <button onclick="goHome()">🏠 처음으로</button>
      </div>
    </div>

    <!-- 정답 피드백 화면 -->
    <div id="feedback" style="display:none;">
      <p id="feedbackMsg"></p>
      <img id="feedbackFlag" style="display:none;">
      <button onclick="nextQuestion()">다음 문제</button>
      <div class="back-btn">
        <button onclick="goHome()">🏠 처음으로</button>
      </div>
    </div>

    <!-- 결과 화면 -->
    <div id="result" style="display:none;">
      <h2>게임 결과</h2>
      <p id="scoreMsg"></p>
      <h3>🏆 순위</h3>
      <ol id="ranking"></ol>
      <div class="back-btn">
        <button onclick="goHome()">🏠 처음으로</button>
      </div>
    </div>
  </div>

  <script>
    let data = [];
    let currentQ, currentQuestion, score, gameMode, player;
    let startTime;
    let ranking = [];
    let chosenQ; // 오답 시 선택된 국가 저장

    let defaultPlayers = ["신준열", "신규열", "파닥이", "수박이"];

    function renderPlayers(){
      let div=document.getElementById("players");
      div.innerHTML="";
      defaultPlayers.forEach(p=>{
        let b=document.createElement("button");
        b.textContent=p;
        b.onclick=()=>{player=p; alert(p+" 선택됨!");};
        div.appendChild(b);
      });
    }

    function addPlayer(){
      let np=document.getElementById("newPlayer").value.trim();
      if(np){
        player=np;
        defaultPlayers.push(np);
        renderPlayers();
        alert(np+" 추가됨!");
      }
    }

    function startGame(mode){
      if(!player){ alert("플레이어를 선택하세요!"); return; }
      gameMode=mode;
      currentQuestion=0; score=0;
      startTime=new Date();
      document.getElementById("start").style.display="none";
      document.getElementById("result").style.display="none";
      nextQuestion();
    }

    function nextQuestion(){
      document.getElementById("feedback").style.display="none";
      document.getElementById("feedbackFlag").style.display="none";

      if(currentQuestion>=10){
        endGame();
        return;
      }
      document.getElementById("game").style.display="block";
      let q=document.getElementById("question");
      let flag=document.getElementById("flag");
      let choices=document.getElementById("choices");
      choices.innerHTML="";
      flag.style.display="none";

      let arr=[...data];
      currentQ=arr[Math.floor(Math.random()*arr.length)];
      let wrongs=arr.filter(x=>x!==currentQ).sort(()=>Math.random()-0.5).slice(0,4);

      document.getElementById("progress").textContent=`문제 ${currentQuestion+1}/10`;

      if(gameMode===1){
        q.textContent=`[${currentQ.continent_ko}] ${currentQ.country_ko}의 수도는 어디일까요?`;
        flag.src=currentQ.flag; flag.style.display="block";
        let opts=[currentQ.capital_ko,...wrongs.map(x=>x.capital_ko)].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let b=document.createElement("button");
          b.className="choice-btn";
          b.textContent=opt;
          b.onclick=()=>checkAnswer(opt===currentQ.capital_ko);
          choices.appendChild(b);
        });
      }
      else if(gameMode===2){
        q.textContent=`이 국기는 어느 나라일까요? (${currentQ.continent_ko})`;
        flag.src=currentQ.flag; flag.style.display="block";
        let opts=[currentQ.country_ko,...wrongs.map(x=>x.country_ko)].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let b=document.createElement("button");
          b.className="choice-btn";
          b.textContent=opt;
          b.onclick=()=>checkAnswer(opt===currentQ.country_ko);
          choices.appendChild(b);
        });
      }
      else if(gameMode===3){
        q.textContent=`[${currentQ.continent_ko}] ${currentQ.country_ko}의 국기는 어느 것일까요?`;
        let opts=[currentQ,...wrongs].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let img=document.createElement("img");
          img.src=opt.flag;
          img.className="choice-img";
          img.onclick=()=>{ chosenQ=opt; checkAnswer(opt===currentQ); };
          choices.appendChild(img);
        });
      }
    }

    function checkAnswer(correct){
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="block";
      let msg=document.getElementById("feedbackMsg");
      let fbFlag=document.getElementById("feedbackFlag");

      if(correct){
        score++;
        msg.textContent="✅ 정답입니다!";
        msg.style.color="green";
        fbFlag.style.display="none";
      } else {
        if(gameMode===3){
          msg.innerHTML=`❌ 오답입니다. 선택하신 국기는 ${chosenQ.country_ko}의 국기입니다.<br>정답은 아래의 국기입니다.`;
          fbFlag.src=currentQ.flag;
          fbFlag.style.display="block";
        } else {
          let correctTxt=(gameMode===1?currentQ.capital_ko:(gameMode===2?currentQ.country_ko:""));
          msg.textContent=`❌ 오답! 정답은 ${correctTxt} 입니다.`;
          msg.style.color="red";
          fbFlag.style.display="none";
        }
      }

      currentQuestion++;
    }

    function endGame(){
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="none";
      document.getElementById("result").style.display="block";
      let elapsed=(new Date()-startTime)/1000;
      let rate=Math.round(score/10*100);
      document.getElementById("scoreMsg").textContent=`정답률: ${rate}%, 시간: ${elapsed.toFixed(1)}초`;

      ranking.push({player,rate,elapsed});
      ranking.sort((a,b)=> b.rate-a.rate || a.elapsed-b.elapsed);
      let ol=document.getElementById("ranking");
      ol.innerHTML="";
      ranking.slice(0,10).forEach((r,i)=>{
        let li=document.createElement("li");
        li.textContent=`${i+1}위 ${r.player} - ${r.rate}% (${r.elapsed.toFixed(1)}초)`;
        ol.appendChild(li);
      });

      let myRank=ranking.findIndex(r=>r.player===player)+1;
      if(myRank<=10){
        alert(`축하합니다! ${myRank}위입니다!!`);
      } else {
        alert("아쉽네요... 분발하세요!!");
      }
    }

    function goHome(){
      document.getElementById("start").style.display="block";
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="none";
      document.getElementById("result").style.display="none";
    }

    fetch("https://shinsangwon.github.io/1001/countries.json")
      .then(r=>r.json())
      .then(j=>{data=j; renderPlayers();})
      .catch(e=>alert("데이터 로드 오류:"+e));
  </script>
</body>
</html>
