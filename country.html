<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚˜ë¼-ìˆ˜ë„ ë§ì¶”ê¸° ê²Œì„1.0</title>
  <style>
    body {
      font-family: "Comic Sans MS", "Arial Rounded MT Bold", Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #ffe6e6, #e6f7ff, #e6ffe6);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: #333;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    h1 {
      font-size: 2.2em;
      color: #444;
      margin-top: 20px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }
    #game, #result, #feedback { display: none; }
    .flag {
      width: 140px;
      margin: 10px auto;
      border: 4px solid #fff;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .option {
      display:block;
      margin:10px auto;
      padding:12px 20px;
      border:none;
      border-radius:20px;
      cursor:pointer;
      width:220px;
      background:#fff7e6;
      font-size:1.1em;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: 0.2s;
    }
    .option:hover {
      background:#ffe0b3;
      transform: scale(1.05);
    }
    .playerBtn {
      margin:6px;
      padding:12px 20px;
      border:none;
      border-radius:20px;
      cursor:pointer;
      background:#e6f2ff;
      font-size:1em;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition:0.2s;
    }
    .playerBtn:hover { background:#cce0ff; transform: scale(1.05); }
    input {
      padding:8px 12px;
      border-radius:15px;
      border:1px solid #ccc;
      margin-top:10px;
    }
    button {
      font-family: inherit;
    }
    #leaderboard {
      margin-top:20px;
    }
    table {
      border-collapse: collapse;
      margin:0 auto;
      background:#fff;
      border-radius:12px;
      overflow:hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    th, td {
      border:1px solid #ddd;
      padding:10px 15px;
    }
    th {
      background:#f9f9f9;
    }
    #feedback {
      margin-top:20px;
      font-size:1.2em;
      font-weight:bold;
      color:#444;
    }
    #nextBtn {
      margin-top:15px;
      padding:10px 18px;
      border:none;
      border-radius:20px;
      background:#d1f0d1;
      cursor:pointer;
      font-size:1em;
      transition:0.2s;
    }
    #nextBtn:hover {
      background:#aee6ae;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <h1>ğŸŒ ë‚˜ë¼-ìˆ˜ë„ ë§ì¶”ê¸° ê²Œì„1.0 ğŸŒˆ</h1>

  <!-- ì°¸ê°€ì ì„ íƒ -->
  <div id="player-select">
    <h3>í”Œë ˆì´ì–´ ì„ íƒ</h3>
    <div>
      <button class="playerBtn" onclick="selectPresetPlayer('ì‹ ì¤€ì—´')">ì‹ ì¤€ì—´</button>
      <button class="playerBtn" onclick="selectPresetPlayer('ì‹ ê·œì—´')">ì‹ ê·œì—´</button>
      <button class="playerBtn" onclick="selectPresetPlayer('íŒŒë‹¥ì´')">íŒŒë‹¥ì´</button>
      <button class="playerBtn" onclick="selectPresetPlayer('ìˆ˜ë°•ì´')">ìˆ˜ë°•ì´</button>
    </div>
    <p>ë˜ëŠ” ì§ì ‘ ì…ë ¥:</p>
    <input type="text" id="customPlayer" placeholder="ì´ë¦„ ì…ë ¥">
    <button onclick="startGame()">ì‹œì‘</button>
  </div>

  <!-- ê²Œì„ ì˜ì—­ -->
  <div id="game">
    <h3 id="qnum"></h3>
    <img id="flag" class="flag">
    <h2 id="question"></h2>
    <div id="options"></div>
  </div>

  <!-- ì •ë‹µ í”¼ë“œë°± -->
  <div id="feedback">
    <p id="feedbackMsg"></p>
    <button id="nextBtn" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
  </div>

  <!-- ê²°ê³¼ -->
  <div id="result">
    <h2 id="finalMsg"></h2>
    <div id="leaderboard"></div>
  </div>

  <script>
    let countries = [];
    let currentQuestion = 0;
    let score = 0;
    let selectedPlayer = "";
    let startTime;
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    let currentAnswer = "";

    // JSON ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("https://shinsangwon.github.io/1001/countries.json")
      .then(res => {
        if (!res.ok) throw new Error("HTTP ìƒíƒœ " + res.status);
        return res.json();
      })
      .then(data => {
        countries = data;
        console.log("ë¡œë“œ ì„±ê³µ:", countries.length, "ê°œ êµ­ê°€");
      })
      .catch(err => console.error("ë¡œë“œ ì‹¤íŒ¨:", err));

    // ë²„íŠ¼ìœ¼ë¡œ ë¯¸ë¦¬ ì„ íƒëœ í”Œë ˆì´ì–´
    function selectPresetPlayer(name) {
      selectedPlayer = name;
      document.getElementById("customPlayer").value = "";
      startGame();
    }

    // ì°¸ê°€ì ì„ íƒ í›„ ì‹œì‘
    function startGame() {
      if (!selectedPlayer) {
        selectedPlayer = document.getElementById("customPlayer").value.trim();
      }
      if (!selectedPlayer) {
        alert("í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”!");
        return;
      }
      document.getElementById("player-select").style.display = "none";
      document.getElementById("game").style.display = "block";
      score = 0;
      currentQuestion = 0;
      startTime = Date.now();
      nextQuestion();
    }

    function nextQuestion() {
      document.getElementById("feedback").style.display = "none";
      if (currentQuestion >= 10) {
        endGame();
        return;
      }
      const q = countries[Math.floor(Math.random() * countries.length)];
      currentAnswer = q.capital_ko;
      const options = [q.capital_ko];
      while (options.length < 5) {
        const rand = countries[Math.floor(Math.random() * countries.length)].capital_ko;
        if (rand && !options.includes(rand)) options.push(rand);
      }
      options.sort(() => Math.random() - 0.5);

      document.getElementById("qnum").textContent = `ë¬¸ì œ ${currentQuestion + 1}/10`;
      document.getElementById("flag").src = q.flag;
      document.getElementById("question").textContent = `${q.country_ko}ì˜ ìˆ˜ë„ëŠ” ì–´ë””ì¼ê¹Œìš”?`;

      const optsDiv = document.getElementById("options");
      optsDiv.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "option";
        btn.textContent = opt;
        btn.onclick = () => checkAnswer(opt);
        optsDiv.appendChild(btn);
      });
    }

    function checkAnswer(choice) {
      const feedback = document.getElementById("feedback");
      const msg = document.getElementById("feedbackMsg");
      if (choice === currentAnswer) {
        score++;
        msg.textContent = "âœ… ì •ë‹µì…ë‹ˆë‹¤!";
        msg.style.color = "green";
      } else {
        msg.textContent = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤! ì •ë‹µì€ "${currentAnswer}" ì…ë‹ˆë‹¤.`;
        msg.style.color = "red";
      }
      document.getElementById("feedback").style.display = "block";
      currentQuestion++;
    }

    function endGame() {
      document.getElementById("game").style.display = "none";
      document.getElementById("result").style.display = "block";
      const timeTaken = Math.floor((Date.now() - startTime) / 1000);
      const accuracy = Math.round((score / 10) * 100);

      leaderboard.push({ name: selectedPlayer, score, time: timeTaken });
      leaderboard.sort((a, b) => b.score - a.score || a.time - b.time);
      leaderboard = leaderboard.slice(0, 10);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

      let rankMsg = "";
      const rank = leaderboard.findIndex(e => e.name === selectedPlayer && e.score === score && e.time === timeTaken) + 1;
      if (rank > 0 && rank <= 10) {
        rankMsg = `ì¶•í•˜í•©ë‹ˆë‹¤! ${rank}ìœ„ì…ë‹ˆë‹¤!!`;
      } else {
        rankMsg = "ì•„ì‰½ë„¤ìš”... ë¶„ë°œí•˜ì„¸ìš”!!";
      }

      document.getElementById("finalMsg").textContent =
        `${selectedPlayer}ë‹˜ì˜ ì ìˆ˜: ${score}/10 (${accuracy}%), ì†Œìš”ì‹œê°„: ${timeTaken}ì´ˆ\n${rankMsg}`;

      let table = "<table><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì ìˆ˜</th><th>ì‹œê°„(ì´ˆ)</th></tr>";
      leaderboard.forEach((p, i) => {
        table += `<tr><td>${i + 1}</td><td>${p.name}</td><td>${p.score}</td><td>${p.time}</td></tr>`;
      });
      table += "</table>";
      document.getElementById("leaderboard").innerHTML = table;
    }
  </script>
</body>
</html>
