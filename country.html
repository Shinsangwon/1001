<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„¸ê³„ ë‚˜ë¼ í€´ì¦ˆ ê²Œì„</title>
  <style>
    body {
      font-family: "Comic Sans MS", sans-serif;
      text-align: center;
      background-color: #fef6fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 480px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      color: #ff6f91;
    }
    button {
      margin: 8px;
      padding: 12px 18px;
      border: none;
      border-radius: 12px;
      background-color: #ffb347;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #ff944d;
    }
    .flag {
      width: 160px;
      margin: 15px auto;
      display: block;
      border: 2px solid #ddd;
      border-radius: 10px;
    }
    .choice-img {
      width: 80px;
      height: 50px;
      object-fit: cover;
      border: 2px solid #ddd;
      border-radius: 6px;
      margin: 5px;
      cursor: pointer;
    }
    .choices {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    #feedbackMsg {
      font-size: 18px;
      margin: 15px 0;
    }
    .back-btn {
      margin-top: 20px;
      background-color: #87ceeb;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ì´ˆê¸° í™”ë©´ -->
    <div id="start">
      <h1>ğŸŒ ì„¸ê³„ ë‚˜ë¼ í€´ì¦ˆ ê²Œì„</h1>
      <p>í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
      <div id="players"></div>
      <input type="text" id="newPlayer" placeholder="ìƒˆ ì°¸ê°€ì ì…ë ¥">
      <button onclick="addPlayer()">ì¶”ê°€</button>
      <h3>ê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”</h3>
      <button onclick="startGame(1)">1. ë‚˜ë¼ì´ë¦„ â†’ ìˆ˜ë„ ë§ì¶”ê¸°</button>
      <button onclick="startGame(2)">2. êµ­ê¸° â†’ ë‚˜ë¼ì´ë¦„ ë§ì¶”ê¸°</button>
      <button onclick="startGame(3)">3. ë‚˜ë¼ì´ë¦„ â†’ êµ­ê¸° ë§ì¶”ê¸°</button>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="game" style="display:none;">
      <h2 id="question"></h2>
      <img id="flag" class="flag" style="display:none;">
      <div id="choices" class="choices"></div>
      <div class="back-btn">
        <button onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ì •ë‹µ í”¼ë“œë°± í™”ë©´ -->
    <div id="feedback" style="display:none;">
      <p id="feedbackMsg"></p>
      <button onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
      <div class="back-btn">
        <button onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div id="result" style="display:none;">
      <h2>ê²Œì„ ê²°ê³¼</h2>
      <p id="scoreMsg"></p>
      <h3>ğŸ† ìˆœìœ„</h3>
      <ol id="ranking"></ol>
      <div class="back-btn">
        <button onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <script>
    let data = [];
    let currentQ, currentQuestion, score, gameMode, player;
    let startTime;
    let ranking = [];

    // ì°¸ê°€ì ê¸°ë³¸ 4ëª…
    let defaultPlayers = ["ì‹ ì¤€ì—´", "ì‹ ê·œì—´", "íŒŒë‹¥ì´", "ìˆ˜ë°•ì´"];

    // ì°¸ê°€ì ë²„íŠ¼ í‘œì‹œ
    function renderPlayers(){
      let div=document.getElementById("players");
      div.innerHTML="";
      defaultPlayers.forEach(p=>{
        let b=document.createElement("button");
        b.textContent=p;
        b.onclick=()=>{player=p; alert(p+" ì„ íƒë¨!");};
        div.appendChild(b);
      });
    }

    function addPlayer(){
      let np=document.getElementById("newPlayer").value.trim();
      if(np){
        player=np;
        defaultPlayers.push(np);
        renderPlayers();
        alert(np+" ì¶”ê°€ë¨!");
      }
    }

    function startGame(mode){
      if(!player){ alert("í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }
      gameMode=mode;
      currentQuestion=0; score=0;
      startTime=new Date();
      document.getElementById("start").style.display="none";
      document.getElementById("result").style.display="none";
      nextQuestion();
    }

    function nextQuestion(){
      document.getElementById("feedback").style.display="none";
      if(currentQuestion>=10){
        endGame();
        return;
      }
      document.getElementById("game").style.display="block";
      let q=document.getElementById("question");
      let flag=document.getElementById("flag");
      let choices=document.getElementById("choices");
      choices.innerHTML="";
      flag.style.display="none";

      let arr=[...data];
      let idx=Math.floor(Math.random()*arr.length);
      currentQ=arr[idx];
      let wrongs=arr.filter(x=>x!==currentQ);
      wrongs=wrongs.sort(()=>Math.random()-0.5).slice(0,4);

      if(gameMode===1){
        q.textContent=`[${currentQ.continent_ko}] ${currentQ.country_ko}ì˜ ìˆ˜ë„ëŠ” ì–´ë””ì¼ê¹Œìš”?`;
        flag.src=currentQ.flag; flag.style.display="block";
        let opts=[currentQ.capital_ko,...wrongs.map(x=>x.capital_ko)].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let b=document.createElement("button");
          b.textContent=opt;
          b.onclick=()=>checkAnswer(opt===currentQ.capital_ko);
          choices.appendChild(b);
        });
      }
      else if(gameMode===2){
        q.textContent="ì´ êµ­ê¸°ëŠ” ì–´ëŠ ë‚˜ë¼ì¼ê¹Œìš”?";
        flag.src=currentQ.flag; flag.style.display="block";
        let opts=[currentQ.country_ko,...wrongs.map(x=>x.country_ko)].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let b=document.createElement("button");
          b.textContent=opt;
          b.onclick=()=>checkAnswer(opt===currentQ.country_ko);
          choices.appendChild(b);
        });
      }
      else if(gameMode===3){
        q.textContent=`[${currentQ.continent_ko}] ${currentQ.country_ko}ì˜ êµ­ê¸°ëŠ” ì–´ëŠ ê²ƒì¼ê¹Œìš”?`;
        let opts=[currentQ,...wrongs].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let img=document.createElement("img");
          img.src=opt.flag;
          img.className="choice-img";
          img.onclick=()=>checkAnswer(opt===currentQ);
          choices.appendChild(img);
        });
      }
    }

    function checkAnswer(correct){
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="block";
      let msg=document.getElementById("feedbackMsg");

      if(correct){
        score++;
        msg.textContent="âœ… ì •ë‹µì…ë‹ˆë‹¤!";
        msg.style.color="green";
      } else {
        let correctTxt=(gameMode===1?currentQ.capital_ko:(gameMode===2?currentQ.country_ko:"í•´ë‹¹ êµ­ê¸°"));
        msg.textContent=`âŒ ì˜¤ë‹µ! ì •ë‹µì€ ${correctTxt} ì…ë‹ˆë‹¤.`;
        msg.style.color="red";
      }

      // ë¬¸ì œ ì¹´ìš´íŠ¸ ì¦ê°€ë¥¼ ì—¬ê¸°ì„œ ìˆ˜í–‰
      currentQuestion++;
    }

    function endGame(){
      document.getElementById("result").style.display="block";
      let elapsed=(new Date()-startTime)/1000;
      let rate=Math.round(score/10*100);
      document.getElementById("scoreMsg").textContent=`ì •ë‹µë¥ : ${rate}%, ì‹œê°„: ${elapsed.toFixed(1)}ì´ˆ`;

      ranking.push({player,rate,elapsed});
      ranking.sort((a,b)=> b.rate-a.rate || a.elapsed-b.elapsed);
      let ol=document.getElementById("ranking");
      ol.innerHTML="";
      ranking.slice(0,10).forEach((r,i)=>{
        let li=document.createElement("li");
        li.textContent=`${i+1}ìœ„ ${r.player} - ${r.rate}% (${r.elapsed.toFixed(1)}ì´ˆ)`;
        ol.appendChild(li);
      });

      let myRank=ranking.findIndex(r=>r.player===player)+1;
      if(myRank<=10){
        alert(`ì¶•í•˜í•©ë‹ˆë‹¤! ${myRank}ìœ„ì…ë‹ˆë‹¤!!`);
      } else {
        alert("ì•„ì‰½ë„¤ìš”... ë¶„ë°œí•˜ì„¸ìš”!!");
      }
    }

    function goHome(){
      document.getElementById("start").style.display="block";
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="none";
      document.getElementById("result").style.display="none";
    }

    // ë°ì´í„° ë¡œë“œ (GitHub Pages)
    fetch("https://shinsangwon.github.io/1001/countries.json")
      .then(r=>r.json())
      .then(j=>{data=j; renderPlayers();})
      .catch(e=>alert("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:"+e));
  </script>
</body>
</html>
