<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ë‚˜ë¼ ë§ì¶”ê¸° ê²Œì„</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #fefaf6;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 { color: #444; margin-top: 20px; }
    .container { padding: 15px; }
    button {
      background-color: #ffcccb;
      border: none; border-radius: 10px;
      padding: 12px 20px; margin: 8px;
      font-size: 16px; cursor: pointer; transition: .3s;
      width: 80%; max-width: 280px;
    }
    button:hover { background-color: #ffb6c1; }
    .flag-img { width: 120px; height: auto; margin: 10px; border: 2px solid #ddd; border-radius: 8px; }
    .game-area { margin-top: 20px; }
    .hidden { display: none; }
    .question-count { font-weight: bold; margin: 10px; }
    .back-btn { margin-top: 20px; background-color: #add8e6; }
    .flag-label { font-weight: 700; margin-bottom: 10px; color:#333; }
    /* ê³µë¶€ ëª¨ë“œ í…Œì´ë¸” */
    .study-table { width:95%; max-width:800px; margin:15px auto; border-collapse:collapse; background:#fff; }
    .study-table th, .study-table td { border:1px solid #ddd; padding:8px; text-align:center; }
    .study-table th { background:#ffe4e1; }
  </style>
</head>
<body>
  <h1>ğŸŒ ë‚˜ë¼ ë§ì¶”ê¸° ê²Œì„1.4</h1>

  <!-- ë©”ë‰´ -->
  <div class="container" id="menu">
    <p>ëª¨ë“  ê²Œì„ì€ 10ë¬¸ì œê°€ ì¶œì œë©ë‹ˆë‹¤.<br>ì˜¤ë‹µ ì‹œ ì •ë‹µì„ ì•Œë ¤ì£¼ê³ , ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</p>
    <button onclick="startGame(1)">1. ë‚˜ë¼ ì´ë¦„ â†’ ìˆ˜ë„ ë§ì¶”ê¸°</button>
    <button onclick="startGame(2)">2. ìˆ˜ë„ ì´ë¦„ â†’ ë‚˜ë¼ ë§ì¶”ê¸°</button>
    <button onclick="startGame(3)">3. êµ­ê¸° â†’ ë‚˜ë¼ ë§ì¶”ê¸°</button>
    <button onclick="startGame(4)">4. ë‚˜ë¼ ì´ë¦„ â†’ êµ­ê¸° ë§ì¶”ê¸°</button>
    <button onclick="showStudy()">5. ë‚˜ë¼-ìˆ˜ë„-êµ­ê¸° ê³µë¶€</button>
  </div>

  <!-- ê²Œì„ ì˜ì—­ -->
  <div class="container game-area hidden" id="gameArea">
    <div id="questionCount" class="question-count"></div>
    <div id="question"></div>
    <img id="flag" class="flag-img hidden" alt="ë¬¸ì œ êµ­ê¸°" />
    <div id="options"></div>
    <div id="feedback"></div>
    <button id="nextBtn" class="hidden" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
    <button class="back-btn" onclick="goHome()">â¬… ì´ˆê¸° í™”ë©´</button>
  </div>

  <!-- ê³µë¶€ ëª¨ë“œ -->
  <div class="container hidden" id="studyArea">
    <h2>ë‚˜ë¼-ìˆ˜ë„-êµ­ê¸° ê³µë¶€</h2>
    <div id="continentFilters"></div>
    <table class="study-table" id="studyTable">
      <thead>
        <tr>
          <th>ëŒ€ë¥™</th><th>êµ­ê¸°</th><th>ë‚˜ë¼</th><th>ìˆ˜ë„</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button class="back-btn" onclick="goHome()">â¬… ì´ˆê¸° í™”ë©´</button>
  </div>

  <script>
    let countries = [];
    let currentGame = 0;
    let currentQuestion = 0;
    let score = 0;
    let selectedQuestions = [];
    let startTime;

    async function loadCountries() {
      const res = await fetch("https://shinsangwon.github.io/1001/countries.json");
      countries = await res.json();
    }

    function goHome() {
      document.getElementById("menu").classList.remove("hidden");
      document.getElementById("gameArea").classList.add("hidden");
      document.getElementById("studyArea").classList.add("hidden");
      document.getElementById("feedback").innerHTML = "";
      document.getElementById("flag").classList.add("hidden");
      score = 0;
      currentQuestion = 0;
    }

    function startGame(gameType) {
      currentGame = gameType;
      document.getElementById("menu").classList.add("hidden");
      document.getElementById("gameArea").classList.remove("hidden");
      score = 0;
      currentQuestion = 0;
      selectedQuestions = shuffle([...countries]).slice(0, 10);
      startTime = new Date();
      loadQuestion();
    }

    function loadQuestion() {
      // ì´ˆê¸°í™”
      document.getElementById("feedback").innerHTML = "";
      document.getElementById("nextBtn").classList.add("hidden");
      document.getElementById("flag").classList.add("hidden");

      if (currentQuestion >= selectedQuestions.length) { endGame(); return; }

      const q = selectedQuestions[currentQuestion];
      document.getElementById("questionCount").innerText = `ë¬¸ì œ ${currentQuestion + 1} / 10`;

      // ë³´ê¸° í›„ë³´ 4ê°œ + ì •ë‹µ í¬í•¨ ë³´ì¥
      let options = shuffle([...countries]).slice(0, 4);
      if (!options.some(c => c.country_ko === q.country_ko)) options[0] = q;
      options = shuffle(options);

      let questionText = "";
      if (currentGame === 1) {
        questionText = `(${q.continent_ko}) ${q.country_ko}ì˜ ìˆ˜ë„ëŠ” ì–´ë””ì¼ê¹Œìš”?`;
        showFlag(q.flag);
        renderOptions(options.map(c => c.capital_ko), q.capital_ko);
      } else if (currentGame === 2) {
        questionText = `(${q.continent_ko}) ${q.capital_ko}ëŠ” ì–´ëŠ ë‚˜ë¼ì˜ ìˆ˜ë„ì¼ê¹Œìš”?`;
        renderOptions(options.map(c => c.country_ko), q.country_ko);
      } else if (currentGame === 3) {
        questionText = `(${q.continent_ko}) ì´ êµ­ê¸°ëŠ” ì–´ëŠ ë‚˜ë¼ì¼ê¹Œìš”?`;
        showFlag(q.flag); // ë¬¸ì œìš© êµ­ê¸°
        renderOptions(options.map(c => c.country_ko), q.country_ko);
      } else if (currentGame === 4) {
        questionText = `(${q.continent_ko}) ${q.country_ko}ì˜ êµ­ê¸°ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?`;
        renderOptions(options.map(c => c.flag), q.flag, true);
      }

      document.getElementById("question").innerText = questionText;
    }

    function showFlag(src) {
      const img = document.getElementById("flag");
      img.src = src;
      img.classList.remove("hidden");
    }

    function renderOptions(optionList, correctAnswer, isFlag = false) {
      const container = document.getElementById("options");
      container.innerHTML = "";
      optionList.forEach(opt => {
        const btn = document.createElement("button");
        btn.innerHTML = isFlag ? `<img src="${opt}" class="flag-img" alt="ë³´ê¸° êµ­ê¸°" />` : opt;
        btn.onclick = () => checkAnswer(opt, correctAnswer, isFlag);
        container.appendChild(btn);
      });
    }

    function checkAnswer(selected, correct, isFlag = false) {
      const feedbackEl = document.getElementById("feedback");
      let html = "";

      const isCorrect = selected === correct;
      if (isCorrect) {
        html = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰";
        score++;
      } else {
        // 3ë²ˆ: êµ­ê¸° â†’ ë‚˜ë¼ (ì˜¤ë‹µ í•´ì„¤: 'ì„ íƒí•œ ë‚˜ë¼ì˜ êµ­ê¸°'ì™€ 'ì •ë‹µ ë‚˜ë¼ì˜ êµ­ê¸°' ë‘˜ ë‹¤ í‘œì‹œ)
        if (currentGame === 3) {
          // ë¬¸ì œìš© êµ­ê¸°ëŠ” ìˆ¨ê¹€(í—·ê°ˆë¦¼ ë°©ì§€)
          document.getElementById("flag").classList.add("hidden");

          const chosenCountry = countries.find(c => c.country_ko === selected);
          const correctCountry = countries.find(c => c.country_ko === correct);

          const chosenFlag = chosenCountry ? chosenCountry.flag : "";
          const correctFlag = correctCountry ? correctCountry.flag : "";

          html = `
            âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.<br>
            ì„ íƒí•˜ì‹  ì•„ë˜ êµ­ê¸°ëŠ” <b>${selected}</b>ì˜ êµ­ê¸°ì…ë‹ˆë‹¤.
            <div><img src="${chosenFlag}" class="flag-img" alt="ì„ íƒí•œ êµ­ê¸°"></div>
            <div class="flag-label">${selected}</div>
            ì •ë‹µì¸ <b>${correct}</b>ì˜ êµ­ê¸°ëŠ” ì•„ë˜ì˜ êµ­ê¸°ì…ë‹ˆë‹¤.
            <div><img src="${correctFlag}" class="flag-img" alt="ì •ë‹µ êµ­ê¸°"></div>
            <div class="flag-label">${correct}</div>
          `;
        }
        // 4ë²ˆ: ë‚˜ë¼ â†’ êµ­ê¸° (ì˜¤ë‹µ ì‹œ ì •ë‹µ êµ­ê¸° ë³´ì—¬ì£¼ê¸°)
        else if (currentGame === 4 && isFlag) {
          html = `ì˜¤ë‹µì…ë‹ˆë‹¤! ì •ë‹µì€ ì•„ë˜ êµ­ê¸°ì…ë‹ˆë‹¤.<br><img src="${correct}" class="flag-img" alt="ì •ë‹µ êµ­ê¸°" />`;
        }
        // 1,2ë²ˆ: í…ìŠ¤íŠ¸ ì •ë‹µ ì•ˆë‚´
        else {
          html = `ì˜¤ë‹µì…ë‹ˆë‹¤! ì •ë‹µì€ <b>${correct}</b> ì…ë‹ˆë‹¤.`;
        }
      }

      feedbackEl.innerHTML = html;
      document.getElementById("nextBtn").classList.remove("hidden");
    }

    function nextQuestion() {
      currentQuestion++;
      loadQuestion();
    }

    function endGame() {
      const duration = ((new Date() - startTime) / 1000).toFixed(1);
      document.getElementById("question").innerHTML =
        `ê²Œì„ ì¢…ë£Œ!<br>ì •ë‹µ ê°œìˆ˜: ${score}/10<br>í’€ì´ ì‹œê°„: ${duration}ì´ˆ`;
      document.getElementById("options").innerHTML = "";
      document.getElementById("flag").classList.add("hidden");
      document.getElementById("questionCount").innerText = "";
      document.getElementById("nextBtn").classList.add("hidden");
      document.getElementById("feedback").innerHTML = "";
    }

    function showStudy() {
      document.getElementById("menu").classList.add("hidden");
      document.getElementById("studyArea").classList.remove("hidden");
      renderContinentFilters();
      renderStudyTable('ì „ì²´');
    }

    function renderContinentFilters() {
      const container = document.getElementById("continentFilters");
      const continents = [...new Set(countries.map(c => c.continent_ko))].sort((a,b)=>a.localeCompare(b,'ko'));
      container.innerHTML = `<button onclick="renderStudyTable('ì „ì²´')">ì „ì²´</button>`;
      continents.forEach(cont => {
        container.innerHTML += `<button onclick="renderStudyTable('${cont}')">${cont}</button>`;
      });
    }

    function renderStudyTable(filter) {
      const tbody = document.querySelector("#studyTable tbody");
      tbody.innerHTML = "";
      let filtered = filter === "ì „ì²´" ? countries : countries.filter(c => c.continent_ko === filter);

      filtered.sort((a, b) => {
        const contCmp = a.continent_ko.localeCompare(b.continent_ko, 'ko');
        if (contCmp !== 0) return contCmp;
        return a.country_ko.localeCompare(b.country_ko, 'ko');
      });

      filtered.forEach(c => {
        tbody.innerHTML += `
          <tr>
            <td>${c.continent_ko}</td>
            <td><img src="${c.flag}" class="flag-img" alt="${c.country_ko} êµ­ê¸°"></td>
            <td>${c.country_ko}</td>
            <td>${c.capital_ko ?? "-"}</td>
          </tr>
        `;
      });
    }

    function shuffle(arr){ return arr.sort(() => Math.random() - 0.5); }

    loadCountries();
  </script>
</body>
</html>
