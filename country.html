<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>나라-수도 맞추기 게임1.0</title>
  <style>
    body {
      font-family: "Comic Sans MS", "Arial Rounded MT Bold", Arial, sans-serif;
      text-align: center;
      background: linear-gradient(135deg, #ffe6e6, #e6f7ff, #e6ffe6);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: #333;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    h1 {
      font-size: 2.2em;
      color: #444;
      margin-top: 20px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
    }
    #game, #result, #feedback { display: none; }
    .flag {
      width: 140px;
      margin: 10px auto;
      border: 4px solid #fff;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .option {
      display:block;
      margin:10px auto;
      padding:12px 20px;
      border:none;
      border-radius:20px;
      cursor:pointer;
      width:220px;
      background:#fff7e6;
      font-size:1.1em;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: 0.2s;
    }
    .option:hover {
      background:#ffe0b3;
      transform: scale(1.05);
    }
    .playerBtn {
      margin:6px;
      padding:12px 20px;
      border:none;
      border-radius:20px;
      cursor:pointer;
      background:#e6f2ff;
      font-size:1em;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      transition:0.2s;
    }
    .playerBtn:hover { background:#cce0ff; transform: scale(1.05); }
    input {
      padding:8px 12px;
      border-radius:15px;
      border:1px solid #ccc;
      margin-top:10px;
    }
    button {
      font-family: inherit;
    }
    #leaderboard {
      margin-top:20px;
    }
    table {
      border-collapse: collapse;
      margin:0 auto;
      background:#fff;
      border-radius:12px;
      overflow:hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    th, td {
      border:1px solid #ddd;
      padding:10px 15px;
    }
    th {
      background:#f9f9f9;
    }
    #feedback {
      margin-top:20px;
      font-size:1.2em;
      font-weight:bold;
      color:#444;
    }
    #nextBtn {
      margin-top:15px;
      padding:10px 18px;
      border:none;
      border-radius:20px;
      background:#d1f0d1;
      cursor:pointer;
      font-size:1em;
      transition:0.2s;
    }
    #nextBtn:hover {
      background:#aee6ae;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <h1>🌍 나라-수도 맞추기 게임1.0 🌈</h1>

  <!-- 참가자 선택 -->
  <div id="player-select">
    <h3>플레이어 선택</h3>
    <div>
      <button class="playerBtn" onclick="selectPresetPlayer('신준열')">신준열</button>
      <button class="playerBtn" onclick="selectPresetPlayer('신규열')">신규열</button>
      <button class="playerBtn" onclick="selectPresetPlayer('파닥이')">파닥이</button>
      <button class="playerBtn" onclick="selectPresetPlayer('수박이')">수박이</button>
    </div>
    <p>또는 직접 입력:</p>
    <input type="text" id="customPlayer" placeholder="이름 입력">
    <button onclick="startGame()">시작</button>
  </div>

  <!-- 게임 영역 -->
  <div id="game">
    <h3 id="qnum"></h3>
    <img id="flag" class="flag">
    <h2 id="question"></h2>
    <div id="options"></div>
  </div>

  <!-- 정답 피드백 -->
  <div id="feedback">
    <p id="feedbackMsg"></p>
    <button id="nextBtn" onclick="nextQuestion()">다음 문제</button>
  </div>

  <!-- 결과 -->
  <div id="result">
    <h2 id="finalMsg"></h2>
    <div id="leaderboard"></div>
  </div>

  <script>
    let countries = [];
    let currentQuestion = 0;
    let score = 0;
    let selectedPlayer = "";
    let startTime;
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    let currentAnswer = "";

    // JSON 불러오기
    fetch("https://shinsangwon.github.io/1001/countries.json")
      .then(res => {
        if (!res.ok) throw new Error("HTTP 상태 " + res.status);
        return res.json();
      })
      .then(data => {
        countries = data;
        console.log("로드 성공:", countries.length, "개 국가");
      })
      .catch(err => console.error("로드 실패:", err));

    // 버튼으로 미리 선택된 플레이어
    function selectPresetPlayer(name) {
      selectedPlayer = name;
      document.getElementById("customPlayer").value = "";
      startGame();
    }

    // 참가자 선택 후 시작
    function startGame() {
      if (!selectedPlayer) {
        selectedPlayer = document.getElementById("customPlayer").value.trim();
      }
      if (!selectedPlayer) {
        alert("플레이어 이름을 입력하거나 선택하세요!");
        return;
      }
      document.getElementById("player-select").style.display = "none";
      document.getElementById("game").style.display = "block";
      score = 0;
      currentQuestion = 0;
      startTime = Date.now();
      nextQuestion();
    }

    function nextQuestion() {
      document.getElementById("feedback").style.display = "none";
      if (currentQuestion >= 10) {
        endGame();
        return;
      }
      const q = countries[Math.floor(Math.random() * countries.length)];
      currentAnswer = q.capital_ko;
      const options = [q.capital_ko];
      while (options.length < 5) {
        const rand = countries[Math.floor(Math.random() * countries.length)].capital_ko;
        if (rand && !options.includes(rand)) options.push(rand);
      }
      options.sort(() => Math.random() - 0.5);

      document.getElementById("qnum").textContent = `문제 ${currentQuestion + 1}/10`;
      document.getElementById("flag").src = q.flag;
      document.getElementById("question").textContent = `${q.country_ko}의 수도는 어디일까요?`;

      const optsDiv = document.getElementById("options");
      optsDiv.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "option";
        btn.textContent = opt;
        btn.onclick = () => checkAnswer(opt);
        optsDiv.appendChild(btn);
      });
    }

    function checkAnswer(choice) {
      const feedback = document.getElementById("feedback");
      const msg = document.getElementById("feedbackMsg");
      if (choice === currentAnswer) {
        score++;
        msg.textContent = "✅ 정답입니다!";
        msg.style.color = "green";
      } else {
        msg.textContent = `❌ 오답입니다! 정답은 "${currentAnswer}" 입니다.`;
        msg.style.color = "red";
      }
      document.getElementById("feedback").style.display = "block";
      currentQuestion++;
    }

    function endGame() {
      document.getElementById("game").style.display = "none";
      document.getElementById("result").style.display = "block";
      const timeTaken = Math.floor((Date.now() - startTime) / 1000);
      const accuracy = Math.round((score / 10) * 100);

      leaderboard.push({ name: selectedPlayer, score, time: timeTaken });
      leaderboard.sort((a, b) => b.score - a.score || a.time - b.time);
      leaderboard = leaderboard.slice(0, 10);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

      let rankMsg = "";
      const rank = leaderboard.findIndex(e => e.name === selectedPlayer && e.score === score && e.time === timeTaken) + 1;
      if (rank > 0 && rank <= 10) {
        rankMsg = `축하합니다! ${rank}위입니다!!`;
      } else {
        rankMsg = "아쉽네요... 분발하세요!!";
      }

      document.getElementById("finalMsg").textContent =
        `${selectedPlayer}님의 점수: ${score}/10 (${accuracy}%), 소요시간: ${timeTaken}초\n${rankMsg}`;

      let table = "<table><tr><th>순위</th><th>이름</th><th>점수</th><th>시간(초)</th></tr>";
      leaderboard.forEach((p, i) => {
        table += `<tr><td>${i + 1}</td><td>${p.name}</td><td>${p.score}</td><td>${p.time}</td></tr>`;
      });
      table += "</table>";
      document.getElementById("leaderboard").innerHTML = table;
    }
  </script>
</body>
</html>
