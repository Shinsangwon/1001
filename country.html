<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‚˜ë¼-ìˆ˜ë„ ë§ì¶”ê¸° ê²Œì„</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f9; padding: 20px; }
    h1 { margin-bottom: 20px; }
    #game, #result-screen { display: none; }
    #flag { width: 150px; margin: 10px 0; border: 1px solid #ccc; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
    .choices { display: flex; flex-direction: column; gap: 10px; max-width: 300px; margin: 20px auto; }
    button { padding: 10px; font-size: 16px; cursor: pointer; border: 1px solid #888; border-radius: 6px; background: #fff; }
    button:hover { background: #e6e6e6; }
    #result { font-size: 18px; font-weight: bold; margin-top: 20px; }
    #rankings { margin-top: 20px; text-align: left; display: inline-block; }
  </style>
</head>
<body>
  <h1>ë‚˜ë¼-ìˆ˜ë„ ë§ì¶”ê¸° ê²Œì„</h1>

  <!-- í”Œë ˆì´ì–´ ì„ íƒ í™”ë©´ -->
  <div id="player-select">
    <h2>í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
    <div>
      <button onclick="selectPlayer('ì‹ ì¤€ì—´')">ì‹ ì¤€ì—´</button>
      <button onclick="selectPlayer('ì‹ ê·œì—´')">ì‹ ê·œì—´</button>
      <button onclick="selectPlayer('íŒŒë‹¥ì´')">íŒŒë‹¥ì´</button>
      <button onclick="selectPlayer('ìˆ˜ë°•ì´')">ìˆ˜ë°•ì´</button>
    </div>
    <p>ì§ì ‘ ì…ë ¥:</p>
    <input type="text" id="custom-name" placeholder="ì´ë¦„ ì…ë ¥" />
    <button onclick="selectCustomPlayer()">í™•ì¸</button>
  </div>

  <!-- ê²Œì„ í™”ë©´ -->
  <div id="game">
    <h2 id="country-name"></h2>
    <img id="flag" alt="êµ­ê¸°" />
    <div class="choices" id="choices"></div>
    <div id="result"></div>
    <button onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
  </div>

  <!-- ê²°ê³¼ í™”ë©´ -->
  <div id="result-screen">
    <h2>ê²Œì„ ê²°ê³¼</h2>
    <p id="summary"></p>
    <div id="rankings"></div>
    <button onclick="restart()">ë‹¤ì‹œ ì‹œì‘</button>
  </div>

  <script>
    let countries = [];
    let correctCapital = "";
    let score = 0;
    let questionCount = 0;
    let playerName = "";
    let startTime;
    let rankings = [];

    async function loadData() {
      const res = await fetch("countries.json");
      countries = await res.json();
    }

    function selectPlayer(name) {
      playerName = name;
      startGame();
    }

    function selectCustomPlayer() {
      const name = document.getElementById("custom-name").value.trim();
      if (name) {
        playerName = name;
        startGame();
      }
    }

    function startGame() {
      document.getElementById("player-select").style.display = "none";
      document.getElementById("game").style.display = "block";
      score = 0;
      questionCount = 0;
      startTime = new Date();
      newQuestion();
    }

    function newQuestion() {
      document.getElementById("result").textContent = "";
      const country = countries[Math.floor(Math.random() * countries.length)];
      correctCapital = country.capital_ko || country.capital_en;
      document.getElementById("country-name").textContent = country.country_ko;
      document.getElementById("flag").src = country.flag;

      // ì˜¤ë‹µ 4ê°œ ì¶”ì¶œ
      let wrongChoices = [];
      while (wrongChoices.length < 4) {
        const rand = countries[Math.floor(Math.random() * countries.length)];
        const cap = rand.capital_ko || rand.capital_en;
        if (cap && cap !== correctCapital && !wrongChoices.includes(cap)) {
          wrongChoices.push(cap);
        }
      }

      // ì •ë‹µ + ì˜¤ë‹µ í•©ì¹˜ê¸°
      const allChoices = [correctCapital, ...wrongChoices];
      shuffle(allChoices);

      // ë³´ê¸° ì¶œë ¥
      const choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";
      allChoices.forEach(choice => {
        const btn = document.createElement("button");
        btn.textContent = choice;
        btn.onclick = () => checkAnswer(choice);
        choicesDiv.appendChild(btn);
      });
    }

    function checkAnswer(choice) {
      if (choice === correctCapital) {
        score++;
        document.getElementById("result").textContent = "âœ… ì •ë‹µ!";
        document.getElementById("result").style.color = "green";
      } else {
        document.getElementById("result").textContent = "âŒ ì˜¤ë‹µ!";
        document.getElementById("result").style.color = "red";
      }
    }

    function nextQuestion() {
      questionCount++;
      if (questionCount >= 10) {
        endGame();
      } else {
        newQuestion();
      }
    }

    function endGame() {
      document.getElementById("game").style.display = "none";
      document.getElementById("result-screen").style.display = "block";
      const endTime = new Date();
      const timeTaken = ((endTime - startTime) / 1000).toFixed(1);

      const accuracy = ((score / 10) * 100).toFixed(0);
      const playerResult = {
        name: playerName,
        score: score,
        accuracy: accuracy,
        time: timeTaken
      };

      rankings.push(playerResult);
      // ì •ë ¬: ì ìˆ˜ ìš°ì„ , ì‹œê°„ ë¹ ë¥¸ ìˆœ
      rankings.sort((a, b) => b.score - a.score || a.time - b.time);
      rankings = rankings.slice(0, 10);

      // ê²°ê³¼ í‘œì‹œ
      const summary = `${playerName}ë‹˜, 10ë¬¸ì œ ì¤‘ ${score}ê°œ ì •ë‹µ (${accuracy}%), ì†Œìš” ì‹œê°„ ${timeTaken}ì´ˆ`;
      document.getElementById("summary").textContent = summary;

      let rankingText = "<h3>ğŸ† ìˆœìœ„í‘œ</h3><ol>";
      rankings.forEach((r, i) => {
        rankingText += `<li>${i+1}ìœ„ - ${r.name} (${r.score}/10, ${r.accuracy}%, ${r.time}ì´ˆ)</li>`;
      });
      rankingText += "</ol>";
      document.getElementById("rankings").innerHTML = rankingText;

      const myRank = rankings.findIndex(r => r.name === playerName && r.score === score && r.time === timeTaken) + 1;
      if (myRank > 0 && myRank <= 10) {
        document.getElementById("rankings").innerHTML += `<p>ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ${myRank}ìœ„ì…ë‹ˆë‹¤!!</p>`;
      } else {
        document.getElementById("rankings").innerHTML += `<p>ğŸ˜¢ ì•„ì‰½ë„¤ìš”... ë¶„ë°œí•˜ì„¸ìš”!!</p>`;
      }
    }

    function restart() {
      document.getElementById("result-screen").style.display = "none";
      document.getElementById("player-select").style.display = "block";
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    loadData();
  </script>
</body>
</html>
