<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„¸ê³„ ë‚˜ë¼ í€´ì¦ˆ ê²Œì„</title>
  <style>
    body {
      font-family: "Comic Sans MS", sans-serif;
      text-align: center;
      background-color: #fef6fb;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: auto;
      padding: 20px;
    }
    h1 {
      color: #ff6f91;
    }
    button {
      margin: 5px;
      padding: 10px 16px;
      border: none;
      border-radius: 12px;
      background-color: #ffb347;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background-color: #ff944d;
    }
    .flag {
      width: 160px;
      margin: 15px auto;
      display: block;
      border: 2px solid #ddd;
      border-radius: 10px;
    }
    .choice-btn {
      display:block;
      margin:8px auto;
      padding:12px;
      border-radius:10px;
      border:none;
      width:90%;
      max-width:300px;
      background:#fff;
      cursor:pointer;
    }
    .choice-img {
      width: 180px;
      height: auto;
      display: block;
      margin: 10px auto;
      border: 3px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
    }
    #feedbackMsg {
      font-size: 18px;
      margin: 15px 0;
    }
    .fb-flag {
      width: 200px;
      margin: 10px auto;
      display: block;
      border: 3px solid #ddd;
      border-radius: 10px;
    }
    .flag-label {
      margin-bottom: 15px;
      font-weight: bold;
      color: #333;
    }
    .back-btn {
      margin-top: 20px;
      background-color: #87ceeb;
    }
    /* ê³µë¶€ ëª¨ë“œ í…Œì´ë¸” */
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      font-size: 14px;
      text-align: center;
    }
    th {
      background-color: #ffb6c1;
    }
    tr:nth-child(even) {
      background-color: #fff0f5;
    }
    tr:nth-child(odd) {
      background-color: #fefefe;
    }
    td img {
      width: 50px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .filter-buttons {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ì´ˆê¸° í™”ë©´ -->
    <div id="start">
      <h1>ğŸŒ ì„¸ê³„ ë‚˜ë¼ í€´ì¦ˆ ê²Œì„1.2</h1>
      <p>í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
      <div id="players"></div>
      <input type="text" id="newPlayer" placeholder="ìƒˆ ì°¸ê°€ì ì…ë ¥">
      <button onclick="addPlayer()">ì¶”ê°€</button>
      <h3>ê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”</h3>
      <p>ğŸ“¢ ê° ê²Œì„ì€ 10ë¬¸ì œê°€ ì¶œì œë©ë‹ˆë‹¤.</p>
      <button onclick="startGame(1)">1. ë‚˜ë¼ì´ë¦„ â†’ ìˆ˜ë„ ë§ì¶”ê¸°</button>
      <button onclick="startGame(2)">2. êµ­ê¸° â†’ ë‚˜ë¼ì´ë¦„ ë§ì¶”ê¸°</button>
      <button onclick="startGame(3)">3. ë‚˜ë¼ì´ë¦„ â†’ êµ­ê¸° ë§ì¶”ê¸°</button>
      <button onclick="studyMode()">4. ë‚˜ë¼-ìˆ˜ë„-êµ­ê¸° ê³µë¶€</button>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="game" style="display:none;">
      <h2 id="progress"></h2>
      <h2 id="question"></h2>
      <img id="flag" class="flag" style="display:none;">
      <div id="choices"></div>
      <div class="back-btn">
        <button onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ì •ë‹µ í”¼ë“œë°± í™”ë©´ -->
    <div id="feedback" style="display:none;">
      <div id="feedbackMsg"></div>
      <img id="chosenFlag" class="fb-flag" style="display:none;">
      <div id="chosenLabel" class="flag-label"></div>
      <div id="answerMsg"></div>
      <img id="correctFlag" class="fb-flag" style="display:none;">
      <div id="correctLabel" class="flag-label"></div>
      <button onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
      <div class="back-btn">
        <button onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div id="result" style="display:none;">
      <h2>ê²Œì„ ê²°ê³¼</h2>
      <p id="scoreMsg"></p>
      <h3>ğŸ† ìˆœìœ„</h3>
      <ol id="ranking"></ol>
      <div class="back-btn">
        <button onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- ê³µë¶€ ëª¨ë“œ í™”ë©´ -->
    <div id="study" style="display:none;">
      <h2>ğŸ“– ë‚˜ë¼-ìˆ˜ë„-êµ­ê¸° ê³µë¶€</h2>
      <div class="filter-buttons" id="continentFilters"></div>
      <div id="studyTable"></div>
      <div class="back-btn">
        <button onclick="goHome()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </div>
  </div>

  <script>
    let data = [];
    let currentQ, currentQuestion, score, gameMode, player;
    let startTime;
    let ranking = [];
    let chosenQ;

    let defaultPlayers = ["ì‹ ì¤€ì—´", "ì‹ ê·œì—´", "íŒŒë‹¥ì´", "ìˆ˜ë°•ì´"];

    function renderPlayers(){
      let div=document.getElementById("players");
      div.innerHTML="";
      defaultPlayers.forEach(p=>{
        let b=document.createElement("button");
        b.textContent=p;
        b.onclick=()=>{player=p; alert(p+" ì„ íƒë¨!");};
        div.appendChild(b);
      });
    }

    function addPlayer(){
      let np=document.getElementById("newPlayer").value.trim();
      if(np){
        player=np;
        defaultPlayers.push(np);
        renderPlayers();
        alert(np+" ì¶”ê°€ë¨!");
      }
    }

    function startGame(mode){
      if(!player){ alert("í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”!"); return; }
      gameMode=mode;
      currentQuestion=0; score=0;
      startTime=new Date();
      document.getElementById("start").style.display="none";
      document.getElementById("result").style.display="none";
      nextQuestion();
    }

    function nextQuestion(){
      document.getElementById("feedback").style.display="none";
      document.getElementById("chosenFlag").style.display="none";
      document.getElementById("correctFlag").style.display="none";
      document.getElementById("chosenLabel").textContent="";
      document.getElementById("correctLabel").textContent="";
      document.getElementById("answerMsg").textContent="";

      if(currentQuestion>=10){
        endGame();
        return;
      }
      document.getElementById("game").style.display="block";
      let q=document.getElementById("question");
      let flag=document.getElementById("flag");
      let choices=document.getElementById("choices");
      choices.innerHTML="";
      flag.style.display="none";

      let arr=[...data];
      currentQ=arr[Math.floor(Math.random()*arr.length)];
      let wrongs=arr.filter(x=>x!==currentQ).sort(()=>Math.random()-0.5).slice(0,4);

      document.getElementById("progress").textContent=`ë¬¸ì œ ${currentQuestion+1}/10`;

      if(gameMode===1){
        q.textContent=`[${currentQ.continent_ko}] ${currentQ.country_ko}ì˜ ìˆ˜ë„ëŠ” ì–´ë””ì¼ê¹Œìš”?`;
        flag.src=currentQ.flag; flag.style.display="block";
        let opts=[currentQ.capital_ko,...wrongs.map(x=>x.capital_ko)].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let b=document.createElement("button");
          b.className="choice-btn";
          b.textContent=opt;
          b.onclick=()=>checkAnswer(opt===currentQ.capital_ko);
          choices.appendChild(b);
        });
      }
      else if(gameMode===2){
        q.textContent=`ì´ êµ­ê¸°ëŠ” ì–´ëŠ ë‚˜ë¼ì¼ê¹Œìš”? (${currentQ.continent_ko})`;
        flag.src=currentQ.flag; flag.style.display="block";
        let opts=[currentQ.country_ko,...wrongs.map(x=>x.country_ko)].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let b=document.createElement("button");
          b.className="choice-btn";
          b.textContent=opt;
          b.onclick=()=>checkAnswer(opt===currentQ.country_ko);
          choices.appendChild(b);
        });
      }
      else if(gameMode===3){
        q.textContent=`[${currentQ.continent_ko}] ${currentQ.country_ko}ì˜ êµ­ê¸°ëŠ” ì–´ëŠ ê²ƒì¼ê¹Œìš”?`;
        let opts=[currentQ,...wrongs].sort(()=>Math.random()-0.5);
        opts.forEach(opt=>{
          let img=document.createElement("img");
          img.src=opt.flag;
          img.className="choice-img";
          img.onclick=()=>{ chosenQ=opt; checkAnswer(opt===currentQ); };
          choices.appendChild(img);
        });
      }
    }

    function checkAnswer(correct){
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="block";
      let msg=document.getElementById("feedbackMsg");
      let chosenFlag=document.getElementById("chosenFlag");
      let correctFlag=document.getElementById("correctFlag");
      let answerMsg=document.getElementById("answerMsg");
      let chosenLabel=document.getElementById("chosenLabel");
      let correctLabel=document.getElementById("correctLabel");

      if(correct){
        score++;
        msg.textContent="âœ… ì •ë‹µì…ë‹ˆë‹¤!";
        msg.style.color="green";
      } else {
        if(gameMode===3){
          msg.innerHTML=`âŒ ì„ íƒí•˜ì‹  ì•„ë˜ êµ­ê¸°ëŠ” ${chosenQ.country_ko}ì˜ êµ­ê¸°ì…ë‹ˆë‹¤.`;
          chosenFlag.src=chosenQ.flag;
          chosenFlag.style.display="block";
          chosenLabel.textContent=chosenQ.country_ko;

          answerMsg.innerHTML=`ì •ë‹µì¸ ${currentQ.country_ko}ì˜ êµ­ê¸°ëŠ” ì•„ë˜ì˜ êµ­ê¸°ì…ë‹ˆë‹¤.`;
          correctFlag.src=currentQ.flag;
          correctFlag.style.display="block";
          correctLabel.textContent=currentQ.country_ko;
        } else {
          let correctTxt=(gameMode===1?currentQ.capital_ko:(gameMode===2?currentQ.country_ko:""));
          msg.textContent=`âŒ ì˜¤ë‹µ! ì •ë‹µì€ ${correctTxt} ì…ë‹ˆë‹¤.`;
          msg.style.color="red";
        }
      }
      currentQuestion++;
    }

    function endGame(){
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="none";
      document.getElementById("result").style.display="block";
      let elapsed=(new Date()-startTime)/1000;
      let rate=Math.round(score/10*100);
      document.getElementById("scoreMsg").textContent=`ì •ë‹µë¥ : ${rate}%, ì‹œê°„: ${elapsed.toFixed(1)}ì´ˆ`;

      ranking.push({player,rate,elapsed});
      ranking.sort((a,b)=> b.rate-a.rate || a.elapsed-b.elapsed);
      let ol=document.getElementById("ranking");
      ol.innerHTML="";
      ranking.slice(0,10).forEach((r,i)=>{
        let li=document.createElement("li");
        li.textContent=`${i+1}ìœ„ ${r.player} - ${r.rate}% (${r.elapsed.toFixed(1)}ì´ˆ)`;
        ol.appendChild(li);
      });

      let myRank=ranking.findIndex(r=>r.player===player)+1;
      if(myRank<=10){
        alert(`ì¶•í•˜í•©ë‹ˆë‹¤! ${myRank}ìœ„ì…ë‹ˆë‹¤!!`);
      } else {
        alert("ì•„ì‰½ë„¤ìš”... ë¶„ë°œí•˜ì„¸ìš”!!");
      }
    }

    function goHome(){
      document.getElementById("start").style.display="block";
      document.getElementById("game").style.display="none";
      document.getElementById("feedback").style.display="none";
      document.getElementById("result").style.display="none";
      document.getElementById("study").style.display="none";
    }

    function studyMode(){
      document.getElementById("start").style.display="none";
      document.getElementById("study").style.display="block";

      // ëŒ€ë¥™ ëª©ë¡
      let continents = [...new Set(data.map(r=>r.continent_ko))].sort();
      let btns = `<button onclick="renderTable()">ì „ì²´</button>`;
      continents.forEach(c=>{
        btns+=`<button onclick="renderTable('${c}')">${c}</button>`;
      });
      document.getElementById("continentFilters").innerHTML=btns;

      renderTable();
    }

    function renderTable(filter=""){
      let tableHTML="<table><tr><th>ëŒ€ë¥™</th><th>êµ­ê¸°</th><th>ë‚˜ë¼</th><th>ìˆ˜ë„</th></tr>";
      let arr=[...data];

      // ì •ë ¬: ëŒ€ë¥™ ê°€ë‚˜ë‹¤ìˆœ, ëŒ€ë¥™ ë‚´ êµ­ê°€ ê°€ë‚˜ë‹¤ìˆœ
      arr.sort((a,b)=>{
        if(a.continent_ko===b.continent_ko){
          return a.country_ko.localeCompare(b.country_ko,"ko");
        }
        return a.continent_ko.localeCompare(b.continent_ko,"ko");
      });

      arr.forEach(row=>{
        if(filter && row.continent_ko!==filter) return;
        tableHTML+=`<tr>
          <td>${row.continent_ko}</td>
          <td><img src="${row.flag}" alt="êµ­ê¸°"></td>
          <td>${row.country_ko}</td>
          <td>${row.capital_ko?row.capital_ko:"-"}</td>
        </tr>`;
      });
      tableHTML+="</table>";
      document.getElementById("studyTable").innerHTML=tableHTML;
    }

    fetch("https://shinsangwon.github.io/1001/countries.json")
      .then(r=>r.json())
      .then(j=>{data=j; renderPlayers();})
      .catch(e=>alert("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:"+e));
  </script>
</body>
</html>
