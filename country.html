<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚˜ë¼ ìˆ˜ë„ êµ­ê¸° í•™ìŠµ ê²Œì„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #fce4ec, #e1f5fe);
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h1 {
      margin: 15px 0;
      font-size: 22px;
    }
    .container {
      max-width: 480px;
      margin: auto;
      padding: 10px;
    }
    .card {
      background: #fff;
      border-radius: 15px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 12px;
      font-size: 15px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #ffccbc;
      transition: background 0.3s;
    }
    button:hover { background-color: #ffab91; }
    .hidden { display: none; }
    .flag-img {
      width: 90px;
      height: auto;
      margin: 8px auto;
      border: 2px solid #ccc;
      border-radius: 8px;
      display: block;
    }
    .options {
      margin-top: 10px;
    }
    .options button {
      font-size: 14px;
      padding: 10px;
    }
    .feedback {
      margin-top: 12px;
      font-size: 15px;
    }
    .study-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 13px;
    }
    .study-table th, .study-table td {
      border: 1px solid #ccc;
      padding: 5px;
    }
    .study-table th { background-color: #f8bbd0; }
    .continent-buttons button {
      display: inline-block;
      width: auto;
      margin: 4px;
      font-size: 13px;
      padding: 6px 10px;
      background-color: #d1c4e9;
    }
    .nav-btn {
      background-color: #b2dfdb;
      font-size: 14px;
      padding: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ë‚˜ë¼ ìˆ˜ë„ êµ­ê¸° í•™ìŠµ ê²Œì„1.5</h1>

    <!-- ë©”ì¸ ë©”ë‰´ -->
    <div id="mainMenu" class="card">
      <p>ê° ê²Œì„ì€ 5ë¬¸ì œê°€ ì¶œì œë©ë‹ˆë‹¤.</p>
      <button onclick="startGame(1)">1. ë‚˜ë¼ â†’ ìˆ˜ë„ ë§ì¶”ê¸°</button>
      <button onclick="startGame(2)">2. ìˆ˜ë„ â†’ ë‚˜ë¼ ë§ì¶”ê¸°</button>
      <button onclick="startGame(3)">3. êµ­ê¸° â†’ ë‚˜ë¼ ë§ì¶”ê¸°</button>
      <button onclick="startGame(4)">4. ë‚˜ë¼ â†’ êµ­ê¸° ë§ì¶”ê¸°</button>
      <button onclick="showStudy()">5. ë‚˜ë¼-ìˆ˜ë„-êµ­ê¸° ê³µë¶€</button>
    </div>

    <!-- ê²Œì„ ì˜ì—­ -->
    <div id="gameArea" class="hidden card">
      <div id="question"></div>
      <div id="options" class="options"></div>
      <div id="feedback" class="feedback"></div>
      <button id="nextBtn" class="hidden" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
      <button class="nav-btn" onclick="goHome()">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <!-- ê³µë¶€ ëª¨ë“œ -->
    <div id="studyArea" class="hidden card">
      <h3>ë‚˜ë¼-ìˆ˜ë„-êµ­ê¸° ê³µë¶€</h3>
      <div class="continent-buttons">
        <button onclick="filterContinent('ì „ì²´')">ì „ì²´</button>
        <button onclick="filterContinent('ì•„ì‹œì•„')">ì•„ì‹œì•„</button>
        <button onclick="filterContinent('ìœ ëŸ½')">ìœ ëŸ½</button>
        <button onclick="filterContinent('ì•„í”„ë¦¬ì¹´')">ì•„í”„ë¦¬ì¹´</button>
        <button onclick="filterContinent('ì•„ë©”ë¦¬ì¹´')">ì•„ë©”ë¦¬ì¹´</button>
        <button onclick="filterContinent('ì˜¤ì„¸ì•„ë‹ˆì•„')">ì˜¤ì„¸ì•„ë‹ˆì•„</button>
      </div>
      <table class="study-table" id="studyTable">
        <thead>
          <tr>
            <th>ëŒ€ë¥™</th><th>êµ­ê¸°</th><th>êµ­ê°€</th><th>ìˆ˜ë„</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button class="nav-btn" onclick="goHome()">ì²˜ìŒìœ¼ë¡œ</button>
    </div>
  </div>

  <script>
    let countries = [];
    let currentGame = 0;
    let currentQuestion = 0;
    let score = 0;
    let selectedQuestions = [];

    async function loadData() {
      const res = await fetch("https://shinsangwon.github.io/1001/countries.json");
      countries = await res.json();
    }

    function goHome() {
      document.getElementById("mainMenu").classList.remove("hidden");
      document.getElementById("gameArea").classList.add("hidden");
      document.getElementById("studyArea").classList.add("hidden");
      document.getElementById("feedback").innerHTML = "";
      document.getElementById("options").innerHTML = "";
    }

    function startGame(game) {
      currentGame = game;
      currentQuestion = 0;
      score = 0;
      selectedQuestions = countries.sort(() => 0.5 - Math.random()).slice(0, 5);
      document.getElementById("mainMenu").classList.add("hidden");
      document.getElementById("gameArea").classList.remove("hidden");
      showQuestion();
    }

    function showQuestion() {
      const q = selectedQuestions[currentQuestion];
      const optionsEl = document.getElementById("options");
      const feedbackEl = document.getElementById("feedback");
      optionsEl.innerHTML = "";
      feedbackEl.innerHTML = "";
      document.getElementById("nextBtn").classList.add("hidden");

      let questionText = "";
      let correctAnswer = "";
      let options = [];

      if (currentGame === 1) {
        questionText = `[${q.continent_ko}] ${q.country_ko}ì˜ ìˆ˜ë„ëŠ” ì–´ë””ì¼ê¹Œìš”? (${currentQuestion+1}/5)`;
        correctAnswer = q.capital_ko;
        options = generateOptions("capital_ko", correctAnswer);
      } else if (currentGame === 2) {
        questionText = `${q.capital_ko}ëŠ” ì–´ëŠ ë‚˜ë¼ì˜ ìˆ˜ë„ì¼ê¹Œìš”? (${currentQuestion+1}/5)`;
        correctAnswer = q.country_ko;
        options = generateOptions("country_ko", correctAnswer);
      } else if (currentGame === 3) {
        questionText = `ì´ êµ­ê¸°ëŠ” ì–´ëŠ ë‚˜ë¼ì˜ êµ­ê¸°ì¼ê¹Œìš”? (${currentQuestion+1}/5)`;
        correctAnswer = q.country_ko;
        options = generateOptions("country_ko", correctAnswer);
      } else if (currentGame === 4) {
        questionText = `[${q.continent_ko}] ${q.country_ko}ì˜ êµ­ê¸°ëŠ” ì–´ëŠ ê²ƒì¼ê¹Œìš”? (${currentQuestion+1}/5)`;
        correctAnswer = q.flag;
        options = generateOptions("flag", correctAnswer);
      }

      document.getElementById("question").innerHTML = questionText;
      if (currentGame === 3) {
        const img = document.createElement("img");
        img.src = q.flag;
        img.className = "flag-img";
        document.getElementById("question").appendChild(img);
      }

      options.forEach(opt => {
        const btn = document.createElement("button");
        if (currentGame === 4) {
          const img = document.createElement("img");
          img.src = opt;
          img.className = "flag-img";
          btn.appendChild(img);
          btn.onclick = () => checkAnswer(opt, correctAnswer, true);
        } else {
          btn.textContent = opt;
          btn.onclick = () => checkAnswer(opt, correctAnswer);
        }
        optionsEl.appendChild(btn);
      });
    }

    function generateOptions(field, correct) {
      const opts = new Set([correct]);
      while (opts.size < 5) {
        const rand = countries[Math.floor(Math.random() * countries.length)][field];
        opts.add(rand);
      }
      return Array.from(opts).sort(() => 0.5 - Math.random());
    }

    function checkAnswer(selected, correct, isFlag = false) {
      const feedbackEl = document.getElementById("feedback");
      let html = "";

      if (selected === correct) {
        html = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰";
        score++;
      } else {
        if (currentGame === 3) {
          const chosenCountry = countries.find(c => c.country_ko === selected);
          const chosenFlag = chosenCountry ? chosenCountry.flag : "";
          html = `
            âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.<br>
            ì •ë‹µì€ <b>${correct}</b> ì…ë‹ˆë‹¤.<br>
            ì„ íƒí•˜ì‹  <b>${selected}</b>ì˜ êµ­ê¸°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
            <div><img src="${chosenFlag}" class="flag-img"></div>
          `;
        } else if (currentGame === 4 && isFlag) {
          const chosenCountry = countries.find(c => c.flag === selected);
          const chosenName = chosenCountry ? chosenCountry.country_ko : "ì•Œ ìˆ˜ ì—†ìŒ";
          const correctCountry = countries.find(c => c.flag === correct);
          const correctName = correctCountry ? correctCountry.country_ko : "ì•Œ ìˆ˜ ì—†ìŒ";
          html = `
            âŒ ì˜¤ë‹µì…ë‹ˆë‹¤.<br>
            ì„ íƒí•˜ì‹  êµ­ê¸°ëŠ” <b>${chosenName}</b>ì˜ êµ­ê¸°ì…ë‹ˆë‹¤.
            <div><img src="${selected}" class="flag-img"></div>
            ì •ë‹µì¸ <b>${correctName}</b>ì˜ êµ­ê¸°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
            <div><img src="${correct}" class="flag-img"></div>
          `;
        } else {
          html = `ì˜¤ë‹µì…ë‹ˆë‹¤! ì •ë‹µì€ <b>${correct}</b> ì…ë‹ˆë‹¤.`;
        }
      }

      feedbackEl.innerHTML = html;
      document.getElementById("nextBtn").classList.remove("hidden");
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < 5) {
        showQuestion();
      } else {
        document.getElementById("question").innerHTML = `ê²Œì„ ì¢…ë£Œ! ì ìˆ˜: ${score}/5`;
        document.getElementById("options").innerHTML = "";
        document.getElementById("feedback").innerHTML = "";
        document.getElementById("nextBtn").classList.add("hidden");
      }
    }

    function showStudy() {
      document.getElementById("mainMenu").classList.add("hidden");
      document.getElementById("studyArea").classList.remove("hidden");
      renderStudyTable("ì „ì²´");
    }

    function filterContinent(continent) {
      renderStudyTable(continent);
    }

    function renderStudyTable(continent) {
      const tbody = document.querySelector("#studyTable tbody");
      tbody.innerHTML = "";
      let filtered = countries;
      if (continent !== "ì „ì²´") {
        filtered = countries.filter(c => c.continent_ko === continent);
      }
      filtered.sort((a, b) => {
        if (a.continent_ko === b.continent_ko) {
          return a.country_ko.localeCompare(b.country_ko, "ko");
        }
        return a.continent_ko.localeCompare(b.continent_ko, "ko");
      });
      filtered.forEach(c => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${c.continent_ko}</td>
          <td><img src="${c.flag}" class="flag-img"></td>
          <td>${c.country_ko}</td>
          <td>${c.capital_ko || "-"}</td>
        `;
        tbody.appendChild(row);
      });
    }

    loadData();
  </script>
</body>
</html>
