<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì„¸ê³„ ë‚˜ë¼ í€´ì¦ˆ ê²Œì„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Comic Sans MS", "Arial Rounded MT Bold", Arial, sans-serif;
      text-align: center;
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #ffe6e6, #e6f7ff, #e6ffe6);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: #333;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    h1 { font-size: 1.8em; margin: 15px; }
    h2, h3 { margin: 10px; }
    #game, #result, #feedback, #mode-select { display: none; }
    .flag {
      width: 120px; max-width: 50vw;
      margin: 10px auto; border: 3px solid #fff; border-radius: 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }
    .option, .playerBtn, .modeBtn, #nextBtn {
      display:block; margin:10px auto; padding:12px;
      border:none; border-radius:18px; cursor:pointer;
      width:80%; max-width:300px; font-size:1em;
      background:#fff; box-shadow:0 3px 6px rgba(0,0,0,0.15);
      transition:0.2s;
    }
    .option:hover, .playerBtn:hover, .modeBtn:hover, #nextBtn:hover {
      transform: scale(1.05);
    }
    .playerBtn { background:#e6f2ff; }
    .modeBtn { background:#ffe6f2; }
    .option img { width:100px; height:auto; border-radius:10px; }
    #feedback { font-size:1.1em; font-weight:bold; }
    #nextBtn { background:#d1f0d1; }
    table { border-collapse: collapse; margin:15px auto; background:#fff; border-radius:10px; overflow:hidden; }
    th, td { border:1px solid #ddd; padding:8px; font-size:0.9em; }
    th { background:#f9f9f9; }
  </style>
</head>
<body>
  <h1>ğŸŒ ì„¸ê³„ ë‚˜ë¼ í€´ì¦ˆ ğŸŒˆ</h1>

  <!-- ì°¸ê°€ì ì„ íƒ -->
  <div id="player-select">
    <h3>í”Œë ˆì´ì–´ ì„ íƒ</h3>
    <div>
      <button class="playerBtn" onclick="selectPresetPlayer('ì‹ ì¤€ì—´')">ì‹ ì¤€ì—´</button>
      <button class="playerBtn" onclick="selectPresetPlayer('ì‹ ê·œì—´')">ì‹ ê·œì—´</button>
      <button class="playerBtn" onclick="selectPresetPlayer('íŒŒë‹¥ì´')">íŒŒë‹¥ì´</button>
      <button class="playerBtn" onclick="selectPresetPlayer('ìˆ˜ë°•ì´')">ìˆ˜ë°•ì´</button>
    </div>
    <p>ë˜ëŠ” ì§ì ‘ ì…ë ¥:</p>
    <input type="text" id="customPlayer" placeholder="ì´ë¦„ ì…ë ¥">
    <button onclick="confirmPlayer()">ë‹¤ìŒ</button>
  </div>

  <!-- ëª¨ë“œ ì„ íƒ -->
  <div id="mode-select">
    <h3>ê²Œì„ ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
    <button class="modeBtn" onclick="startGame(1)">1ï¸âƒ£ ë‚˜ë¼ â†’ ìˆ˜ë„ ë§ì¶”ê¸°</button>
    <button class="modeBtn" onclick="startGame(2)">2ï¸âƒ£ êµ­ê¸° â†’ ë‚˜ë¼ ë§ì¶”ê¸°</button>
    <button class="modeBtn" onclick="startGame(3)">3ï¸âƒ£ ë‚˜ë¼ â†’ êµ­ê¸° ë§ì¶”ê¸°</button>
  </div>

  <!-- ê²Œì„ ì˜ì—­ -->
  <div id="game">
    <h3 id="qnum"></h3>
    <div id="questionArea"></div>
    <div id="options"></div>
  </div>

  <!-- ì •ë‹µ í”¼ë“œë°± -->
  <div id="feedback">
    <p id="feedbackMsg"></p>
    <button id="nextBtn" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
  </div>

  <!-- ê²°ê³¼ -->
  <div id="result">
    <h2 id="finalMsg"></h2>
    <div id="leaderboard"></div>
  </div>

  <script>
    let countries = [];
    let currentQuestion = 0, score = 0;
    let selectedPlayer = "", startTime, gameMode = 1;
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
    let currentAnswer = "", currentQ;

    // JSON ë¶ˆëŸ¬ì˜¤ê¸°
    fetch("https://shinsangwon.github.io/1001/countries.json")
      .then(res => res.json())
      .then(data => { countries = data; })
      .catch(err => console.error("ë¡œë“œ ì‹¤íŒ¨:", err));

    function selectPresetPlayer(name){ selectedPlayer=name; document.getElementById("customPlayer").value=""; confirmPlayer(); }
    function confirmPlayer(){
      if(!selectedPlayer) selectedPlayer=document.getElementById("customPlayer").value.trim();
      if(!selectedPlayer){ alert("í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ê±°ë‚˜ ì„ íƒí•˜ì„¸ìš”!"); return; }
      document.getElementById("player-select").style.display="none";
      document.getElementById("mode-select").style.display="block";
    }

    function startGame(mode){
      gameMode=mode;
      score=0; currentQuestion=0;
      startTime=Date.now();
      document.getElementById("mode-select").style.display="none";
      document.getElementById("game").style.display="block";
      nextQuestion();
    }

    function nextQuestion(){
      document.getElementById("feedback").style.display="none";
      if(currentQuestion>=10){ endGame(); return; }
      currentQ=countries[Math.floor(Math.random()*countries.length)];
      currentAnswer = (gameMode===1?currentQ.capital_ko:currentQ.country_ko);
      currentQuestion++;
      document.getElementById("qnum").textContent=`ë¬¸ì œ ${currentQuestion}/10`;
      const qArea=document.getElementById("questionArea"), optsDiv=document.getElementById("options");
      qArea.innerHTML=""; optsDiv.innerHTML="";
      
      if(gameMode===1){ // ë‚˜ë¼â†’ìˆ˜ë„
        qArea.innerHTML=`<h2>${currentQ.continent_ko}ì— ìˆëŠ” ${currentQ.country_ko}ì˜ ìˆ˜ë„ëŠ”?</h2><img class="flag" src="${currentQ.flag}">`;
        let options=[currentQ.capital_ko];
        while(options.length<5){ let opt=countries[Math.floor(Math.random()*countries.length)].capital_ko; if(opt && !options.includes(opt)) options.push(opt); }
        options.sort(()=>Math.random()-0.5);
        options.forEach(opt=>{ let btn=document.createElement("button"); btn.className="option"; btn.textContent=opt; btn.onclick=()=>checkAnswer(opt); optsDiv.appendChild(btn); });
      }
      else if(gameMode===2){ // êµ­ê¸°â†’ë‚˜ë¼
        qArea.innerHTML=`<h2>ì´ êµ­ê¸°ëŠ” ì–´ëŠ ë‚˜ë¼ì¼ê¹Œìš”?</h2><img class="flag" src="${currentQ.flag}">`;
        let options=[currentQ.country_ko];
        while(options.length<5){ let opt=countries[Math.floor(Math.random()*countries.length)].country_ko; if(opt && !options.includes(opt)) options.push(opt); }
        options.sort(()=>Math.random()-0.5);
        options.forEach(opt=>{ let btn=document.createElement("button"); btn.className="option"; btn.textContent=opt; btn.onclick=()=>checkAnswer(opt); optsDiv.appendChild(btn); });
      }
      else if(gameMode===3){ // ë‚˜ë¼â†’êµ­ê¸°
        qArea.innerHTML=`<h2>${currentQ.continent_ko}ì— ìˆëŠ” ${currentQ.country_ko}ì˜ êµ­ê¸°ëŠ”?</h2>`;
        let options=[currentQ.flag];
        while(options.length<5){ let opt=countries[Math.floor(Math.random()*countries.length)].flag; if(opt && !options.includes(opt)) options.push(opt); }
        options.sort(()=>Math.random()-0.5);
        options.forEach(opt=>{ let btn=document.createElement("button"); btn.className="option"; btn.innerHTML=`<img src="${opt}">`; btn.onclick=()=>checkAnswer(opt); optsDiv.appendChild(btn); });
      }
    }

    function checkAnswer(choice){
      document.getElementById("feedback").style.display="block";
      let msg=document.getElementById("feedbackMsg");
      if((gameMode===1 && choice===currentQ.capital_ko) || (gameMode===2 && choice===currentQ.country_ko) || (gameMode===3 && choice===currentQ.flag)){
        score++; msg.textContent="âœ… ì •ë‹µì…ë‹ˆë‹¤!"; msg.style.color="green";
      } else {
        let correct = (gameMode===1? currentQ.capital_ko : (gameMode===2? currentQ.country_ko : "í•´ë‹¹ êµ­ê¸°"));
        msg.textContent=`âŒ ì˜¤ë‹µ! ì •ë‹µì€ ${correct} ì…ë‹ˆë‹¤.`; msg.style.color="red";
      }
    }

    function endGame(){
      document.getElementById("game").style.display="none";
      document.getElementById("result").style.display="block";
      let time=Math.floor((Date.now()-startTime)/1000);
      let accuracy=Math.round((score/10)*100);
      leaderboard.push({name:selectedPlayer, score, time});
      leaderboard.sort((a,b)=>b.score-a.score||a.time-b.time);
      leaderboard=leaderboard.slice(0,10);
      localStorage.setItem("leaderboard",JSON.stringify(leaderboard));
      let rank=leaderboard.findIndex(p=>p.name===selectedPlayer&&p.score===score&&p.time===time)+1;
      let msg=(rank>0&&rank<=10)?`ì¶•í•˜í•©ë‹ˆë‹¤! ${rank}ìœ„ì…ë‹ˆë‹¤!!`:"ì•„ì‰½ë„¤ìš”... ë¶„ë°œí•˜ì„¸ìš”!!";
      document.getElementById("finalMsg").textContent=`${selectedPlayer}ë‹˜ì˜ ì ìˆ˜: ${score}/10 (${accuracy}%), ì†Œìš”ì‹œê°„ ${time}ì´ˆ\n${msg}`;
      let html="<h3>ğŸ† ìˆœìœ„í‘œ</h3><table><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ì ìˆ˜</th><th>ì‹œê°„</th></tr>";
      leaderboard.forEach((p,i)=>{ html+=`<tr><td>${i+1}</td><td>${p.name}</td><td>${p.score}</td><td>${p.time}</td></tr>`; });
      html+="</table>"; document.getElementById("leaderboard").innerHTML=html;
    }
  </script>
</body>
</html>
