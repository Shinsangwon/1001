<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>덧셈 & 모으기/가르기 게임</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Malgun Gothic,Apple SD Gothic Neo,sans-serif;background:#ffe4ec;color:#222;min-height:100vh;display:flex;align-items:center;justify-content:center}
    .wrap{max-width:640px;width:100%;padding:16px}
    h1{text-align:center;font-size:28px;margin:12px 0;color:#ff4081}
    .desc{font-size:15px;color:#555;text-align:center;margin-bottom:16px}
    .card{background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.12);padding:20px;margin-bottom:16px}
    .problem-box{border:3px solid #ff6fa0;border-radius:12px;padding:20px;text-align:center;background:#fff0f5;}
    .problem{font-size:24px;font-weight:bold;margin:10px 0;line-height:1.8}
    .question-number{font-size:16px;color:#555;margin-bottom:8px}
    .keypad{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:16px}
    .keypad button{padding:14px;font-size:18px;border:none;border-radius:8px;background:#ffb6c1;cursor:pointer;transition:.2s}
    .keypad button:hover{background:#ff91af}
    .feedback{text-align:center;margin-top:12px;height:24px;font-weight:bold}
    .ok{color:green}.bad{color:red}
    #timerAdd,#timerSplit{font-weight:bold;font-size:18px}
    .results{padding:20px;text-align:center}
    .results h2{text-align:center;margin:0 0 8px}
    .finish-message{font-size:24px;color:#ff4081;font-weight:bold;margin-bottom:16px}
    .center-btn{display:flex;justify-content:center;margin-top:20px;gap:10px;flex-wrap:wrap}
    .start-big{padding:20px 40px;font-size:22px;border:none;border-radius:12px;background:#ff4081;color:#fff;font-weight:bold;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.2);transition:.2s}
    .start-big:hover{background:#e73370}
    .blank{display:inline-block;min-width:40px;border-bottom:2px solid #ff4081;margin:0 4px;padding:2px 6px;font-size:28px;color:#111;border-radius:6px}
    .blank.active{background:#ffd6e6;border-bottom:3px solid #ff4081;box-shadow:0 0 0 3px rgba(255,64,129,.15)}
    .char-btn{padding:10px 18px;margin:4px;font-size:16px;border:none;border-radius:8px;background:#ffe0eb;cursor:pointer}
    .char-btn.selected{background:#ff4081;color:#fff}

    /* --- 순위표 스타일 --- */
    .ranking {
      margin-top:20px;
      padding:16px;
      border-radius:12px;
      background:linear-gradient(135deg,#fff8dc,#ffd700);
      box-shadow:0 4px 10px rgba(0,0,0,0.15);
    }
    .ranking h3 {
      color:#b8860b;
      text-align:center;
      margin-bottom:12px;
      font-size:20px;
    }
    .ranking ol {
      list-style:none;
      padding:0;
      margin:0;
    }
    .ranking li {
      margin:6px 0;
      padding:8px 12px;
      border-radius:8px;
      font-size:16px;
      font-weight:bold;
      background:#fffbe6;
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }
    .ranking li:first-child {
      background:linear-gradient(135deg,#fffacd,#ffd700);
      color:#8b7500;
    }
    .ranking li:nth-child(2) {
      background:linear-gradient(135deg,#f0f0f0,#c0c0c0);
      color:#444;
    }
    .ranking li:nth-child(3) {
      background:linear-gradient(135deg,#fff0e0,#cd7f32);
      color:#5a3a1a;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>신준열규열 공부게임(v1.1)</h1>
    <div class="desc">
      <p><b>덧셈 게임</b>: 1~20 버튼으로 정답을 입력하여 빠르게 푸는 게임 (5문제 세트)</p>
      <p><b>모으기와 가르기</b>: 10을 기준으로 식을 단계별로 완성합니다. 버튼으로 빈칸 3개를 <b>순서대로</b> 맞혀야 합니다 (3문제 세트)</p>
    </div>
    <div id="startScreen" class="card">
      <div style="margin-bottom:12px;">캐릭터 선택:</div>
      <div>
        <button class="char-btn" data-name="신준열">신준열</button>
        <button class="char-btn" data-name="신규열">신규열</button>
        <button class="char-btn" data-name="파닥이">파닥이</button>
        <button class="char-btn" data-name="수박이">수박이</button>
      </div>
      <div style="margin:12px 0;">또는 직접 입력:</div>
      <input id="playerName" placeholder="이름 입력 (없으면 캐릭터/메롱)" />
      <div class="center-btn">
        <button id="additionSelect" class="start-big">1. 덧셈 게임</button>
        <button id="splitSelect" class="start-big">2. 모으기와 가르기</button>
      </div>
    </div>

    <!-- 덧셈 게임 화면 -->
    <div id="additionGameScreen" class="card problem-box" hidden>
      <div class="question-number" id="qNumberAdd"></div>
      <div id="problemBoxAdd" class="problem"></div>
      <div id="keypadAdd" class="keypad"></div>
      <div id="feedbackAdd" class="feedback"></div>
      <div style="margin-top:12px;text-align:center"><span id="timerAdd">0.00초</span></div>
      <div class="center-btn"><button id="backFromAdd" class="start-big">게임선택으로</button></div>
    </div>

    <!-- 모으기/가르기 게임 화면 -->
    <div id="splitGameScreen" class="card problem-box" hidden>
      <div class="question-number" id="qNumberSplit"></div>
      <div id="problemBoxSplit" class="problem"></div>
      <div id="keypadSplit" class="keypad"></div>
      <div id="feedbackSplit" class="feedback"></div>
      <div style="margin-top:12px;text-align:center"><span id="timerSplit">0.00초</span></div>
      <div class="center-btn"><button id="backFromSplit" class="start-big">게임선택으로</button></div>
    </div>

    <!-- 결과 화면 공통 -->
    <div id="results" class="card results" hidden>
      <div class="finish-message">수고했어요!</div>
      <h2>결과</h2>
      <div>총 소요시간: <span id="totalTime"></span></div>
      <div>정답 개수: <span id="correctCount"></span></div>
      <div>평균 시간/문제: <span id="avgTime"></span></div>
      <div>오답 시도: <span id="mistakes"></span></div>
      <div class="ranking">
        <h3>🏆 순위표 🏆</h3>
        <div id="rankInfo"></div>
        <ol id="rankingList"></ol>
      </div>
      <div class="center-btn">
        <button id="restartBtn" class="start-big">게임선택으로</button>
      </div>
    </div>
  </div>

  <audio id="soundCorrect" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="soundWrong" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

  <script>
    const charButtons = document.querySelectorAll('.char-btn');
    let selectedChar = '';

    charButtons.forEach(btn=>{
      btn.addEventListener('click',()=>{
        charButtons.forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedChar = btn.dataset.name;
      });
    });

    function getPlayerName(){
      const manual = document.getElementById('playerName').value.trim();
      if(manual) return manual;
      if(selectedChar) return selectedChar;
      return '메롱';
    }

    function renderRanking(ranking,record){
      const rankingList=document.getElementById('rankingList');
      const rankInfo=document.getElementById('rankInfo');
      rankingList.innerHTML='';
      let myRank=null;
      ranking.forEach((r,i)=>{
        const li=document.createElement('li');
        let medal='';
        if(i===0) medal='🥇 ';
        else if(i===1) medal='🥈 ';
        else if(i===2) medal='🥉 ';
        else medal='⭐ ';
        li.textContent=`${medal}${i+1}위: ${r.name} (${r.mode==='addition'?'덧셈':'모으기/가르기'}) 점수:${r.score}, 시간:${(r.time/1000).toFixed(2)}초`;
        rankingList.appendChild(li);
        if(r===record) myRank=i+1;
      });
      rankInfo.textContent=myRank?`현재 기록은 ${myRank}위 입니다.`:'';
    }

    // ⚠️ 이 아래에는 이전 덧셈/모으기/가르기 게임 로직 동일하게 두시면 됩니다.
    // saveRanking 함수에서 const name=getPlayerName(); 으로 불러오도록만 수정하세요.
  </script>
</body>
</html>


