<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì—°ì‚° ê²Œì„ ëª¨ìŒ</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Malgun Gothic,Apple SD Gothic Neo,sans-serif;background:#ffe4ec;color:#222;min-height:100vh;display:flex;align-items:center;justify-content:center}
    .wrap{max-width:720px;width:100%;padding:16px}
    h1{text-align:center;font-size:28px;margin:12px 0;color:#ff4081}
    .desc{font-size:15px;color:#555;text-align:center;margin-bottom:16px}
    .card{background:#fff;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.12);padding:20px;margin-bottom:16px}
    .problem-box{border:3px solid #ff6fa0;border-radius:12px;padding:20px;text-align:center;background:#fff0f5}
    .problem{font-size:24px;font-weight:bold;margin:10px 0;line-height:1.8}
    .question-number{font-size:16px;color:#555;margin-bottom:8px}
    .keypad{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:16px}
    .keypad button{padding:14px;font-size:18px;border:none;border-radius:8px;background:#ffb6c1;cursor:pointer;transition:.2s}
    .keypad button:hover{background:#ff91af}
    .numpad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:16px}
    .numpad button{padding:16px;font-size:20px;border:none;border-radius:10px;background:#ffd1dc;cursor:pointer}
    .numpad button:hover{background:#ffb0c0}
    .answer-box{margin-top:10px;font-size:22px;font-weight:bold}
    .feedback{text-align:center;margin-top:12px;height:24px;font-weight:bold}
    .ok{color:green}.bad{color:red}
    .timer{font-weight:bold;font-size:18px}
    .finish-message{font-size:24px;color:#ff4081;font-weight:bold;margin-bottom:16px}
    .center-btn{display:flex;justify-content:center;margin-top:20px;gap:10px;flex-wrap:wrap}
    .start-big{padding:18px 28px;font-size:20px;border:none;border-radius:12px;background:#ff4081;color:#fff;font-weight:bold;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.2)}
    .start-big:hover{background:#e73370}
    .blank{display:inline-block;min-width:40px;border-bottom:2px solid #ff4081;margin:0 4px;padding:2px 6px;font-size:28px;color:#111;border-radius:6px}
    .blank.active{background:#ffd6e6;border-bottom:3px solid #ff4081;box-shadow:0 0 0 3px rgba(255,64,129,.15)}
    .chip{padding:8px 12px;margin:4px;border-radius:999px;border:none;background:#ffe0eb;cursor:pointer}
    .chip.selected{background:#ff4081;color:#fff}
    .char-btn{padding:10px 18px;margin:4px;font-size:16px;border:none;border-radius:8px;background:#ffe0eb;cursor:pointer}
    .char-btn.selected{background:#ff4081;color:#fff}
    /* ìˆœìœ„í‘œ: í™©ê¸ˆ í…Œë§ˆ */
    .ranking {margin-top:20px;padding:16px;border-radius:12px;background:linear-gradient(135deg,#fff8dc,#ffd700);box-shadow:0 4px 10px rgba(0,0,0,.15)}
    .ranking h3 {color:#b8860b;text-align:center;margin-bottom:12px;font-size:20px}
    .ranking ol {list-style:none;padding:0;margin:0}
    .ranking li {margin:6px 0;padding:8px 12px;border-radius:8px;font-size:16px;font-weight:bold;background:#fffbe6;box-shadow:0 2px 5px rgba(0,0,0,.1)}
    .ranking li:first-child {background:linear-gradient(135deg,#fffacd,#ffd700);color:#8b7500}
    .ranking li:nth-child(2) {background:linear-gradient(135deg,#f0f0f0,#c0c0c0);color:#444}
    .ranking li:nth-child(3) {background:linear-gradient(135deg,#fff0e0,#cd7f32);color:#5a3a1a}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ê²Œì„ ì„ íƒ</h1>
    <div class="desc">
      <p>1. ë§ì…ˆ(5ë¬¸ì œ) Â· 2. ëº„ì…ˆ(5ë¬¸ì œ) Â· 3. ëª¨ìœ¼ê¸°/ê°€ë¥´ê¸°(3ë¬¸ì œ) Â· 4. êµ¬êµ¬ë‹¨(5ë¬¸ì œ, ë‹¨ ì„ íƒ) Â· 5. ë‚˜ëˆ—ì…ˆ(5ë¬¸ì œ)</p>
    </div>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="startScreen" class="card">
      <div style="margin-bottom:12px;">ìºë¦­í„° ì„ íƒ:</div>
      <div>
        <button type="button" class="char-btn" data-name="ì‹ ì¤€ì—´">ì‹ ì¤€ì—´</button>
        <button type="button" class="char-btn" data-name="ì‹ ê·œì—´">ì‹ ê·œì—´</button>
        <button type="button" class="char-btn" data-name="íŒŒë‹¥ì´">íŒŒë‹¥ì´</button>
        <button type="button" class="char-btn" data-name="ìˆ˜ë°•ì´">ìˆ˜ë°•ì´</button>
      </div>
      <div style="margin:12px 0;">ë˜ëŠ” ì§ì ‘ ì…ë ¥:</div>
      <input id="playerName" placeholder="ì´ë¦„ ì…ë ¥ (ì—†ìœ¼ë©´ ìºë¦­í„°/ë¬´ëª…)" />
      <div class="center-btn">
        <button type="button" id="additionSelect" class="start-big">1. ë§ì…ˆ ê²Œì„</button>
        <button type="button" id="subtractionSelect" class="start-big">2. ëº„ì…ˆ ê²Œì„</button>
        <button type="button" id="splitSelect" class="start-big">3. ëª¨ìœ¼ê¸°/ê°€ë¥´ê¸°</button>
        <button type="button" id="guguSelect" class="start-big">4. êµ¬êµ¬ë‹¨ ê²Œì„</button>
        <button type="button" id="divisionSelect" class="start-big">5. ë‚˜ëˆ—ì…ˆ ê²Œì„</button>
      </div>
    </div>

    <!-- ê³µí†µ: ê²°ê³¼ í™”ë©´ -->
    <div id="results" class="card" hidden>
      <div class="finish-message">ìˆ˜ê³ í–ˆì–´ìš”!</div>
      <h2>ê²°ê³¼</h2>
      <div>ì´ ì†Œìš”ì‹œê°„: <span id="totalTime"></span></div>
      <div>ì •ë‹µ ê°œìˆ˜: <span id="correctCount"></span></div>
      <div>í‰ê·  ì‹œê°„/ë¬¸ì œ: <span id="avgTime"></span></div>
      <div>ì˜¤ë‹µ ì‹œë„: <span id="mistakes"></span></div>
      <div class="ranking">
        <h3 id="rankingTitle">ğŸ† ìˆœìœ„í‘œ ğŸ†</h3>
        <div id="rankInfo"></div>
        <ol id="rankingList"></ol>
      </div>
      <div class="center-btn">
        <button type="button" id="restartBtn" class="start-big">ê²Œì„ì„ íƒìœ¼ë¡œ</button>
      </div>
    </div>

    <!-- 1. ë§ì…ˆ -->
    <div id="additionGameScreen" class="card problem-box" hidden>
      <div class="question-number" id="qNumberAdd"></div>
      <div id="problemBoxAdd" class="problem"></div>
      <div id="keypadAdd" class="keypad"></div>
      <div id="feedbackAdd" class="feedback"></div>
      <div style="margin-top:12px;text-align:center" class="timer" id="timerAdd">0.00ì´ˆ</div>
      <div class="center-btn"><button type="button" id="backFromAdd" class="start-big">ê²Œì„ì„ íƒìœ¼ë¡œ</button></div>
    </div>

    <!-- 2. ëº„ì…ˆ -->
    <div id="subtractionGameScreen" class="card problem-box" hidden>
      <div class="question-number" id="qNumberSub"></div>
      <div id="problemBoxSub" class="problem"></div>
      <div id="keypadSub" class="keypad"></div>
      <div id="feedbackSub" class="feedback"></div>
      <div style="margin-top:12px;text-align:center" class="timer" id="timerSub">0.00ì´ˆ</div>
      <div class="center-btn"><button type="button" id="backFromSub" class="start-big">ê²Œì„ì„ íƒìœ¼ë¡œ</button></div>
    </div>

    <!-- 3. ëª¨ìœ¼ê¸°/ê°€ë¥´ê¸° -->
    <div id="splitGameScreen" class="card problem-box" hidden>
      <div class="question-number" id="qNumberSplit"></div>
      <div id="problemBoxSplit" class="problem"></div>
      <div id="keypadSplit" class="keypad"></div>
      <div id="feedbackSplit" class="feedback"></div>
      <div style="margin-top:12px;text-align:center" class="timer" id="timerSplit">0.00ì´ˆ</div>
      <div class="center-btn"><button type="button" id="backFromSplit" class="start-big">ê²Œì„ì„ íƒìœ¼ë¡œ</button></div>
    </div>

    <!-- 4. êµ¬êµ¬ë‹¨ (ë‹¨ ì„ íƒ + ìˆ«ìíŒ¨ë“œ ì…ë ¥) -->
    <div id="guguGameScreen" class="card problem-box" hidden>
      <div style="margin-bottom:8px">ì¶œì œ ë²”ìœ„(ë‹¨) ì„ íƒ:</div>
      <div id="danChips" class="center-btn" style="margin-top:8px"></div>
      <div class="center-btn" style="margin-top:8px">
        <button type="button" id="danAll" class="chip">ì „ì²´ì„ íƒ</button>
        <button type="button" id="danClear" class="chip">ì´ˆê¸°í™”</button>
        <button type="button" id="guguStart" class="start-big">ë¬¸ì œ ì‹œì‘</button>
      </div>
      <div class="question-number" id="qNumberMul"></div>
      <div id="problemBoxMul" class="problem"></div>
      <div id="answerMul" class="answer-box"></div>
      <div id="numpadMul" class="numpad"></div>
      <div id="feedbackMul" class="feedback"></div>
      <div style="margin-top:12px;text-align:center" class="timer" id="timerMul">0.00ì´ˆ</div>
      <div class="center-btn"><button type="button" id="backFromMul" class="start-big">ê²Œì„ì„ íƒìœ¼ë¡œ</button></div>
    </div>

    <!-- 5. ë‚˜ëˆ—ì…ˆ (1~20 í‚¤íŒ¨ë“œ) -->
    <div id="divisionGameScreen" class="card problem-box" hidden>
      <div class="question-number" id="qNumberDiv"></div>
      <div id="problemBoxDiv" class="problem"></div>
      <div id="keypadDiv" class="keypad"></div>
      <div id="feedbackDiv" class="feedback"></div>
      <div style="margin-top:12px;text-align:center" class="timer" id="timerDiv">0.00ì´ˆ</div>
      <div class="center-btn"><button type="button" id="backFromDiv" class="start-big">ê²Œì„ì„ íƒìœ¼ë¡œ</button></div>
    </div>
  </div>

  <audio id="soundCorrect" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="soundWrong" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>

  <script>
  document.addEventListener('DOMContentLoaded',function(){
    // --- ê³µí†µ ìœ í‹¸ ---
    const $=id=>document.getElementById(id);
    const soundCorrect=$('soundCorrect');
    const soundWrong=$('soundWrong');
    function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min}
    function formatMs(ms){return (ms/1000).toFixed(2)+'ì´ˆ'}

    // --- ì´ë¦„ ì„ íƒ ---
    const charButtons=document.querySelectorAll('.char-btn');
    let selectedChar='';
    charButtons.forEach(btn=>{
      btn.addEventListener('click',()=>{
        charButtons.forEach(b=>b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedChar=btn.dataset.name;
      });
    });
    function getPlayerName(){
      const manual=$('playerName').value.trim();
      if(manual) return manual; if(selectedChar) return selectedChar; return 'ë¬´ëª…';
    }

    // --- í™”ë©´ ì°¸ì¡° ---
    const screens={
      start:$('startScreen'), results:$('results'),
      add:$('additionGameScreen'), sub:$('subtractionGameScreen'), split:$('splitGameScreen'),
      gugu:$('guguGameScreen'), div:$('divisionGameScreen')
    };

    // --- ìƒíƒœ ---
    let state={};
    function showOnly(key){
      Object.values(screens).forEach(sc=>sc.hidden=true);
      screens[key].hidden=false;
    }

    // --- íƒ€ì´ë¨¸ ---
    function tick(timerEl){
      function step(){
        const ms=performance.now()-state.startTime; timerEl.textContent=(ms/1000).toFixed(2)+'ì´ˆ';
        state.timerId=requestAnimationFrame(step);
      }
      cancelAnimationFrame(state.timerId); state.timerId=requestAnimationFrame(step);
    }

    // --- ë­í‚¹(ëª¨ë“œë³„ ë¶„ë¦¬ ì €ì¥) ---
    const rankingTitle=$('rankingTitle'), rankingList=$('rankingList'), rankInfo=$('rankInfo');
    function saveRanking(totalMs){
      const name=getPlayerName();
      const record={name,score:state.total,time:totalMs,mode:state.mode};
      const key='ranking_'+state.mode; // addition / subtraction / split / multiplication / division
      let ranking=JSON.parse(localStorage.getItem(key)||'[]');
      ranking.push(record);
      ranking.sort((a,b)=> b.score-a.score || a.time-b.time);
      ranking=ranking.slice(0,20);
      localStorage.setItem(key,JSON.stringify(ranking));
      renderRanking(ranking,record);
      const titleMap={addition:'ë§ì…ˆ',subtraction:'ëº„ì…ˆ',split:'ëª¨ìœ¼ê¸°/ê°€ë¥´ê¸°',multiplication:'êµ¬êµ¬ë‹¨',division:'ë‚˜ëˆ—ì…ˆ'};
      rankingTitle.textContent=`ğŸ† ìˆœìœ„í‘œ (${titleMap[state.mode]}) ğŸ†`;
    }
    function renderRanking(ranking,record){
      rankingList.innerHTML=''; let myRank=null;
      ranking.forEach((r,i)=>{
        const li=document.createElement('li');
        const medal=i===0?'ğŸ¥‡ ':i===1?'ğŸ¥ˆ ':i===2?'ğŸ¥‰ ':'â­ ';
        li.textContent=`${medal}${i+1}ìœ„: ${r.name} (ì ìˆ˜:${r.score}, ì‹œê°„:${(r.time/1000).toFixed(2)}ì´ˆ)`;
        rankingList.appendChild(li); if(r===record) myRank=i+1;
      });
      rankInfo.textContent=myRank?`í˜„ì¬ ê¸°ë¡ì€ ${myRank}ìœ„ ì…ë‹ˆë‹¤.`:'';
    }

    function finish(){
      cancelAnimationFrame(state.timerId);
      const totalMs=performance.now()-state.startTime;
      $('totalTime').textContent=formatMs(totalMs);
      $('correctCount').textContent=state.total;
      $('avgTime').textContent=(totalMs/1000/state.total).toFixed(2)+'ì´ˆ';
      $('mistakes').textContent=state.mistakes;
      showOnly('results');
      saveRanking(totalMs);
    }

    // ===== 1. ë§ì…ˆ (ë²„íŠ¼ 1~20) =====
    const qNumberAdd=$('qNumberAdd'), problemBoxAdd=$('problemBoxAdd'), feedbackAdd=$('feedbackAdd'), keypadAdd=$('keypadAdd'), timerAdd=$('timerAdd');
    function newAdditionProblem(){
      for(let i=0;i<100;i++){const a=randInt(0,10),b=randInt(0,10);const s=a+b; if(s>=1 && s<=20) return {a,b};}
      return {a:1,b:1};
    }
    function buildKeypad(container,handler){
      container.innerHTML=''; for(let i=1;i<=20;i++){const b=document.createElement('button'); b.type='button'; b.textContent=i; b.onclick=()=>handler(i); container.appendChild(b);} }
    function startAddition(){
      state={mode:'addition',total:5,index:0,startTime:performance.now(),mistakes:0};
      showOnly('add'); nextAddition(); tick(timerAdd);
    }
    function nextAddition(){
      state.current=newAdditionProblem(); qNumberAdd.textContent=`${state.index+1}ë²ˆ ë¬¸ì œ`; problemBoxAdd.textContent=`${state.current.a} + ${state.current.b} = ?`; feedbackAdd.textContent=''; buildKeypad(keypadAdd,submitAddition);
    }
    function submitAddition(ans){
      if(ans===state.current.a+state.current.b){ soundCorrect.play(); state.index++; if(state.index>=state.total) finish(); else nextAddition(); }
      else { soundWrong.play(); feedbackAdd.textContent='ì˜¤ë‹µ! ë‹¤ì‹œ ì‹œë„'; feedbackAdd.className='feedback bad'; state.mistakes++; }
    }

    // ===== 2. ëº„ì…ˆ (ë²„íŠ¼ 1~20) =====
    const qNumberSub=$('qNumberSub'), problemBoxSub=$('problemBoxSub'), feedbackSub=$('feedbackSub'), keypadSub=$('keypadSub'), timerSub=$('timerSub');
    function newSubtractionProblem(){
      const a=randInt(1,20); const b=randInt(0,a-1); // a>b, a,b â‰¤20
      return {a,b}; // ì •ë‹µ a-b âˆˆ 1..20 ë³´ì¥
    }
    function startSubtraction(){
      state={mode:'subtraction',total:5,index:0,startTime:performance.now(),mistakes:0};
      showOnly('sub'); nextSubtraction(); tick(timerSub);
    }
    function nextSubtraction(){
      state.current=newSubtractionProblem(); qNumberSub.textContent=`${state.index+1}ë²ˆ ë¬¸ì œ`; problemBoxSub.textContent=`${state.current.a} - ${state.current.b} = ?`; feedbackSub.textContent=''; buildKeypad(keypadSub,submitSubtraction);
    }
    function submitSubtraction(ans){
      if(ans===state.current.a-state.current.b){ soundCorrect.play(); state.index++; if(state.index>=state.total) finish(); else nextSubtraction(); }
      else{ soundWrong.play(); feedbackSub.textContent='ì˜¤ë‹µ! ë‹¤ì‹œ ì‹œë„'; feedbackSub.className='feedback bad'; state.mistakes++; }
    }

    // ===== 3. ëª¨ìœ¼ê¸°/ê°€ë¥´ê¸° (ê°€ë³€ p, ë²„íŠ¼ 1~20) =====
    const qNumberSplit=$('qNumberSplit'), problemBoxSplit=$('problemBoxSplit'), feedbackSplit=$('feedbackSplit'), keypadSplit=$('keypadSplit'), timerSplit=$('timerSplit');
    function newSplitProblem(){
      for(let tries=0; tries<200; tries++){
        const isAdd=Math.random()<0.5;
        if(isAdd){
          const a=randInt(2,19), b=randInt(1,20-a), p=randInt(1,a-1); const s1=a-p, s2=s1+b, s3=a+b; if(s1>=1&&s1<=20&&s2>=1&&s2<=20&&s3<=20) return {type:'add',a,b,p,solution:[s1,s2,s3]};
        }else{
          const a=randInt(3,20), r=randInt(1,Math.min(10,a-2)), b=a-r, pMin=r+1, pMax=a-1; if(pMin<=pMax){ const p=randInt(pMin,pMax); const s1=a-p, s2=b-s1, s3=r; if(s1>=1&&s1<=20&&s2>=1&&s2<=20&&s3>=1&&s3<=10) return {type:'sub',a,b,p,solution:[s1,s2,s3]}; }
        }
      }
      return {type:'add',a:11,b:1,p:10,solution:[1,2,12]};
    }
    function startSplit(){ state={mode:'split',total:3,index:0,startTime:performance.now(),mistakes:0,focus:0,answers:[null,null,null]}; showOnly('split'); nextSplit(); tick(timerSplit);}    
    function nextSplit(){ state.current=newSplitProblem(); state.focus=0; state.answers=[null,null,null]; qNumberSplit.textContent=`${state.index+1}ë²ˆ ë¬¸ì œ`; renderSplitProblem(); feedbackSplit.textContent=''; buildKeypad(keypadSplit,submitSplitStep);}    
    function renderSplitProblem(){ const {type,a,b,p}=state.current; if(type==='add'){ problemBoxSplit.innerHTML=`<div style="font-size:28px;margin:8px 0">${a} + ${b}</div><div style="font-size:28px;margin:8px 0">= ${p} + <span class="blank ${state.focus===0?'active':''}">${state.answers[0]??''}</span> + ${b}</div><div style="font-size:28px;margin:8px 0">= ${p} + <span class="blank ${state.focus===1?'active':''}">${state.answers[1]??''}</span> = <span class="blank ${state.focus===2?'active':''}">${state.answers[2]??''}</span></div>`;} else { problemBoxSplit.innerHTML=`<div style="font-size:28px;margin:8px 0">${a} - ${b}</div><div style="font-size:28px;margin:8px 0">= ${p} + <span class="blank ${state.focus===0?'active':''}">${state.answers[0]??''}</span> - ${b}</div><div style="font-size:28px;margin:8px 0">= ${p} - <span class="blank ${state.focus===1?'active':''}">${state.answers[1]??''}</span> = <span class="blank ${state.focus===2?'active':''}">${state.answers[2]??''}</span></div>`; } }
    function submitSplitStep(val){ const idx=state.focus; const target=state.current.solution[idx]; if(val===target){ soundCorrect.play(); state.answers[idx]=val; state.focus++; if(state.focus>=3){ state.index++; if(state.index>=state.total) finish(); else nextSplit(); } else { renderSplitProblem(); } } else { soundWrong.play(); feedbackSplit.textContent='ì˜¤ë‹µ! ë‹¤ì‹œ ì‹œë„'; feedbackSplit.className='feedback bad'; state.mistakes++; state.answers=[null,null,null]; state.focus=0; renderSplitProblem(); } }

    // ===== 4. êµ¬êµ¬ë‹¨ (ë‹¨ ì„ íƒ + ìˆ«ìíŒ¨ë“œ) =====
    const danChips=$('danChips'), danAll=$('danAll'), danClear=$('danClear'), guguStart=$('guguStart');
    const qNumberMul=$('qNumberMul'), problemBoxMul=$('problemBoxMul'), answerMul=$('answerMul'), numpadMul=$('numpadMul'), feedbackMul=$('feedbackMul'), timerMul=$('timerMul');
    let selectedDans=new Set([1,2,3,4,5,6,7,8,9]);
    function renderDanChips(){ danChips.innerHTML=''; for(let d=1; d<=9; d++){ const btn=document.createElement('button'); btn.type='button'; btn.className='chip'+(selectedDans.has(d)?' selected':''); btn.textContent=d+'ë‹¨'; btn.onclick=()=>{ selectedDans.has(d)?selectedDans.delete(d):selectedDans.add(d); renderDanChips(); }; danChips.appendChild(btn);} }
    function buildNumpad(container,onSubmit,onChange){ container.innerHTML=''; const keys=['1','2','3','4','5','6','7','8','9','0','â†','í™•ì¸']; keys.forEach(k=>{ const b=document.createElement('button'); b.type='button'; b.textContent=k; b.onclick=()=>{ if(k==='í™•ì¸') onSubmit(); else if(k==='â†'){ onChange('back'); } else { onChange(k); } }; container.appendChild(b); }); }
    let mulInput='';
    function startGugu(){ state={mode:'multiplication',total:5,index:0,startTime:performance.now(),mistakes:0}; showOnly('gugu'); renderDanChips(); guguStart.disabled=false; answerMul.textContent='ë‹¨ì„ ì„ íƒí•˜ê³  [ë¬¸ì œ ì‹œì‘]ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”'; problemBoxMul.textContent=''; qNumberMul.textContent=''; feedbackMul.textContent=''; numpadMul.innerHTML=''; tick(timerMul); }
    function beginGuguSet(){ if(selectedDans.size===0){ feedbackMul.textContent='ë‹¨ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”'; feedbackMul.className='feedback bad'; return;} guguStart.disabled=true; nextGugu(); buildNumpad(numpadMul, submitGugu, changeMulInput); }
    function newGuguProblem(){ const a=[...selectedDans][randInt(1,selectedDans.size)-1]; const b=randInt(1,9); return {a,b}; }
    function nextGugu(){ state.current=newGuguProblem(); mulInput=''; qNumberMul.textContent=`${state.index+1}ë²ˆ ë¬¸ì œ`; problemBoxMul.textContent=`${state.current.a} Ã— ${state.current.b} = ?`; answerMul.textContent='ì…ë ¥: '; feedbackMul.textContent=''; }
    function changeMulInput(key){ if(key==='back'){ mulInput=mulInput.slice(0,-1); } else { if(mulInput.length<2) mulInput+=key; } answerMul.textContent='ì…ë ¥: '+mulInput; }
    function submitGugu(){ const ans=(state.current.a*state.current.b).toString(); if(mulInput===ans){ soundCorrect.play(); state.index++; if(state.index>=state.total) finish(); else nextGugu(); } else { soundWrong.play(); feedbackMul.textContent='ì˜¤ë‹µ! ë‹¤ì‹œ ì‹œë„'; feedbackMul.className='feedback bad'; state.mistakes++; mulInput=''; answerMul.textContent='ì…ë ¥: '; } }

    // ===== 5. ë‚˜ëˆ—ì…ˆ (ë²„íŠ¼ 1~20) =====
    const qNumberDiv=$('qNumberDiv'), problemBoxDiv=$('problemBoxDiv'), feedbackDiv=$('feedbackDiv'), keypadDiv=$('keypadDiv'), timerDiv=$('timerDiv');
    function newDivisionProblem(){ const d=randInt(1,10); const q=randInt(1,Math.floor(20/d)); const c=d*q; return {c,d}; } // c,d â‰¤20, ë‹µ 1..20
    function startDivision(){ state={mode:'division',total:5,index:0,startTime:performance.now(),mistakes:0}; showOnly('div'); nextDivision(); tick(timerDiv); }
    function nextDivision(){ state.current=newDivisionProblem(); qNumberDiv.textContent=`${state.index+1}ë²ˆ ë¬¸ì œ`; problemBoxDiv.textContent=`${state.current.c} Ã· ${state.current.d} = ?`; feedbackDiv.textContent=''; buildKeypad(keypadDiv,submitDivision); }
    function submitDivision(ans){ if(ans===state.current.c/state.current.d){ soundCorrect.play(); state.index++; if(state.index>=state.total) finish(); else nextDivision(); } else { soundWrong.play(); feedbackDiv.textContent='ì˜¤ë‹µ! ë‹¤ì‹œ ì‹œë„'; feedbackDiv.className='feedback bad'; state.mistakes++; } }

    // --- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ---
    $('additionSelect').onclick=startAddition;
    $('subtractionSelect').onclick=startSubtraction;
    $('splitSelect').onclick=startSplit;
    $('guguSelect').onclick=startGugu;
    $('divisionSelect').onclick=startDivision;

    $('backFromAdd').onclick=()=>showOnly('start');
    $('backFromSub').onclick=()=>showOnly('start');
    $('backFromSplit').onclick=()=>showOnly('start');
    $('backFromMul').onclick=()=>showOnly('start');
    $('backFromDiv').onclick=()=>showOnly('start');

    $('restartBtn').onclick=()=>showOnly('start');

    $('danAll').onclick=()=>{ selectedDans=new Set([1,2,3,4,5,6,7,8,9]); renderDanChips(); };
    $('danClear').onclick=()=>{ selectedDans.clear(); renderDanChips(); };
    $('guguStart').onclick=beginGuguSet;
  });
  </script>
</body>
</html>
